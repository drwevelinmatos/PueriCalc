<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadoras Pediátricas</title>

  <!-- Bibliotecas e Fontes -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <>
    :root {
      --primary: rgb(40,90,129);
      --secondary: rgb(185,224,229);
      --emergency: #d32f2f;
      --cardio: #c0392b;
      --lab: #16a085;
      --renal: #2980b9;
      --check: #27ae60;
      --bg: #f4f7f9;
      --text: #2c3e50;
      --white: #ffffff;
      --shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Inter', 'Arial', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
    h1, h2, h3 { font-family: 'Comfortaa', cursive; text-align: center; color: var(--primary); }

    header {
      background: var(--white); padding: 28px 20px 16px; text-align: center;
      box-shadow: var(--shadow); border-bottom: 3px solid var(--primary);
    }

    nav {
      position: sticky; top: 0; z-index: 1000; background: var(--primary);
      display: flex; overflow-x: auto; padding: 5px; scrollbar-width: none;
    }
    nav::-webkit-scrollbar { display: none; }
    .nav-btn {
      background: none; border: none; color: rgba(255,255,255,0.7);
      padding: 12px 18px; font-size: 0.75rem; font-weight: 700;
      white-space: nowrap; cursor: pointer; text-transform: uppercase;
    }
    .nav-btn.active { color: var(--white); border-bottom: 3px solid var(--white); }

    .container { padding: 18px; max-width: 780px; margin: 0 auto; padding-bottom: 110px; }
    .tab-content { display: none; animation: fadeIn 0.25s ease; }
    .tab-content.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .card {
      background: var(--white); border-radius: 15px; padding: 18px;
      margin-bottom: 18px; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.03);
    }
    .card-header {
      border-left: 5px solid var(--primary); padding-left: 12px; margin-bottom: 12px; text-align: left;
    }
    .card-header h2 { text-align: left; margin: 0; font-size: 1.05rem; }

    label { display: block; font-size: 0.8rem; font-weight: 800; margin-top: 10px; color: var(--primary); }
    input, select, textarea {
      width: 100%; padding: 12px; border-radius: 8px;
      border: 1px solid #dce4ec; background: rgb(185,224,229); font-size: 16px; color: var(--text);
    }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

    button.calc-btn {
      width: 100%; padding: 14px; border-radius: 10px; border: none;
      background: var(--primary); color: white; font-weight: 800;
      cursor: pointer; margin-top: 14px; font-family: 'Comfortaa';
    }
    button.calc-btn:active { transform: scale(0.98); opacity: 0.92; }

    .result-box {
      margin-top: 14px; padding: 14px; border-radius: 10px;
      background: var(--secondary); border: 1px solid rgba(40,90,129,0.2);
      display: none; font-size: 0.9rem; line-height: 1.6; white-space: pre-line;
    }
    .destaque { font-weight: 900; color: var(--primary); }
    .muted { color: #6b7b87; font-size: 0.78rem; margin-top: 8px; line-height: 1.3; }
    .warn { color: #8a2b2b; font-weight: 800; }

    table { width: 100%; border-collapse: collapse; margin-top: 12px; font-size: 0.8rem; }
    th { background: var(--primary); color: white; padding: 8px; }
    td { border: 1px solid #eee; padding: 8px; text-align: center; }
    tr:nth-child(even) { background: #f9f9f9; }

    footer { text-align: center; padding: 30px 18px; color: #7f8c8d; font-size: 0.75rem; border-top: 1px solid #eee; }

    /* ===== CARDIO: sub-abas internas ===== */
    .subnav{
      display:flex;
      gap:8px;
      padding:10px;
      background: rgba(40,90,129,0.08);
      border: 1px solid rgba(40,90,129,0.15);
      border-radius: 12px;
      margin-bottom: 14px;
      overflow:auto;
    }
    .subnav button{
      border: 0;
      background: rgba(40,90,129,0.12);
      color: var(--primary);
      font-weight: 800;
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
      white-space: nowrap;
    }
    .subnav button.active{
      background: var(--primary);
      color: #fff;
    }
    .cardio-sub{ display:none; }
    .cardio-sub.active{ display:block; }

    /* ===== MRPA: blocos de impressão ===== */
    .mrpa-title{
      font-family: 'Comfortaa', cursive;
      text-align:center;
      color: var(--primary);
      margin: 6px 0 14px;
    }
    .mrpa-row-title{
      margin: 0 0 10px;
      color: var(--primary);
      font-family: 'Comfortaa', cursive;
      font-size: 0.95rem;
      text-align:left;
    }
    .mrpa-grid-2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .mrpa-grid-3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; }

    .mrpa-label{
      font-size: 0.78rem;
      font-weight: 800;
      color: var(--primary);
      margin: 6px 0 4px;
    }
    .mrpa-box{
      height: 34px;
      border: 1px solid #dce4ec;
      background: #fff;
      border-radius: 8px;
    }
    .mrpa-box.tall{ height: 70px; }

    .mrpa-medicao{
      border: 1px solid rgba(0,0,0,0.05);
      border-radius: 12px;
      padding: 10px;
      background: #fff;
    }

    .mrpa-actions{
      display:flex;
      gap:10px;
      margin: 10px 0 14px;
    }
    .mrpa-actions .calc-btn{ margin-top:0; }

    /* ===== impressão: mostra só MRPA quando mandar imprimir ===== */
    @media print{
      header, nav, footer, .container > :not(#tab-cardio){ display:none !important; }
      #tab-cardio .card:not(#mrpa-print-area){ display:none !important; }
      #mrpa-print-area{ display:block !important; box-shadow:none !important; border:none !important; }
      .mrpa-actions{ display:none !important; }
      body{ background:#fff !important; }
      .container{ max-width: none !important; padding: 0 !important; }
    }
    /* ===== PRINT: imprimir SOMENTE o MRPA ===== */
@media print {
  body * {
    visibility: hidden !important;
  }
  #mrpa-print-area, #mrpa-print-area * {
    visibility: visible !important;
  }
  #mrpa-print-area {
    position: absolute !important;
    left: 0 !important;
    top: 0 !important;
    width: 100% !important;
  }

  /* remove sombras e fundos “web” */
  .card { box-shadow: none !important; }
}
    /* ===== MRPA (blocos para escrever à caneta) ===== */
.mrpa-grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.mrpa-grid-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; }

.mrpa-label{
  font-size: 0.78rem;
  font-weight: 800;
  color: var(--primary);
  margin: 8px 0 6px;
}

.mrpa-box{
  border: 1.6px solid rgba(0,0,0,0.75);
  border-radius: 8px;
  height: 30px;
  background: #fff;
}

.mrpa-box.big{ height: 70px; }

.mrpa-row-title{
  font-family: 'Comfortaa', cursive;
  font-weight: 800;
  color: var(--primary);
  font-size: 0.95rem;
  margin: 0 0 8px;
}

.mrpa-medicao{
  border: 1px solid rgba(0,0,0,0.12);
  border-radius: 12px;
  padding: 10px;
  background: #fff;
}

@media (max-width: 900px){
  .mrpa-grid-2{ grid-template-columns:1fr; }
  .mrpa-grid-3{ grid-template-columns:1fr; }
}

/* ===== PRINT: imprimir SOMENTE o MRPA + garantir bordas ===== */
@media print{
  body *{ visibility:hidden !important; }
  #mrpa-print-area, #mrpa-print-area *{ visibility:visible !important; }

  #mrpa-print-area{
    position:absolute !important;
    left:0 !important;
    top:0 !important;
    width:100% !important;
  }

  /* remove sombras e fundos do app */
  .card{ box-shadow:none !important; background:#fff !important; }

  /* força bordas fortes no PDF */
  .mrpa-box{ border: 1.6px solid #000 !important; }
  .mrpa-medicao{ border: 1px solid #000 !important; }
}
  </style>
</head>

<body>
  <header>
    <h1>Calculadoras Pediátricas</h1>
    <div class="muted">Neonato • Crescimento • Cardio • Emergência • Hidratação • Laboratórios • Checklist</div>
  </header>

  <nav>
    <button class="nav-btn active" onclick="openTab('tab-neo', this)">Neonato</button>
    <button class="nav-btn" onclick="openTab('tab-cresc', this)">Crescimento</button>
    <button class="nav-btn" onclick="openTab('tab-cardio', this)">Cardio</button>
    <button class="nav-btn" onclick="openTab('tab-emerg', this)">Emergência</button>
    <button class="nav-btn" onclick="openTab('tab-hidra', this)">Hidratação</button>
    <button class="nav-btn" onclick="openTab('tab-lab', this)">Laboratórios</button>
    <button class="nav-btn" onclick="openTab('tab-check', this)">Checklist</button>
  </nav>

  <div class="container">

    <!-- ========================= -->
    <!-- ABA NEONATOLOGIA (ORDEM) -->
    <!-- ========================= -->
    <div id="tab-neo" class="tab-content active">

      <!-- 1) Idade Gestacional e DPP (ok) -->
      <div class="card">
        <div class="card-header"><h2>Idade Gestacional e DPP</h2></div>

        <label>Modo de Entrada</label>
        <select id="neo-modo" onchange="toggleNeoInput()">
          <option value="dum">DUM (Data Última Menstruação)</option>
          <option value="usg">USG 1º Trimestre</option>
        </select>

        <div id="box-dum">
          <label>Data da DUM</label>
          <input type="date" id="neo-dum">
        </div>

        <div id="box-usg" style="display:none">
          <label>Data do USG</label>
          <input type="date" id="neo-usg-data">
          <div class="grid-2">
            <div>
              <label>Semanas no USG</label>
              <input type="number" id="neo-usg-sem" min="0" step="1">
            </div>
            <div>
              <label>Dias no USG</label>
              <input type="number" id="neo-usg-dias" min="0" max="6" step="1">
            </div>
          </div>
        </div>

        <label>Data para cálculo (ex.: data do parto)</label>
        <input type="date" id="neo-ig-calc">

        <button class="calc-btn" onclick="calcNeoIG()">Calcular IG e DPP</button>
        <div id="res-neo-ig" class="result-box"></div>
      </div>

      <!-- 2) IG Corrigida Pós-Nascimento -->
      <div class="card">
        <div class="card-header"><h2>Idade Gestacional Corrigida Pós-Nascimento</h2></div>

        <div class="grid-2">
          <div>
            <label>IG ao nascimento (semanas)</label>
            <input type="number" id="neo-ig-nasc-sem" min="0" step="1">
          </div>
          <div>
            <label>IG ao nascimento (dias)</label>
            <input type="number" id="neo-ig-nasc-dias" min="0" max="6" step="1">
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label>Data de nascimento</label>
            <input type="date" id="neo-data-nasc">
          </div>
          <div>
            <label>Data para cálculo</label>
            <input type="date" id="neo-data-posnatal">
          </div>
        </div>

        <button class="calc-btn" onclick="calcIGCorrigidaPosNatal()">Calcular Corrigida Pós-Natal</button>
        <div id="res-neo-igcorr" class="result-box"></div>

        <div class="muted">
          Lógica: soma o tempo pós-natal (dias) à IG ao nascimento e retorna <span class="destaque">semanas + dias</span>.
        </div>
      </div>

      <!-- 3) Peso para IG (INTERGROWTH-21st) -->
      <div class="card">
        <div class="card-header"><h2>Peso para Idade Gestacional (INTERGROWTH-21st)</h2></div>

        <div class="grid-2">
          <div>
            <label>Sexo</label>
            <select id="neo-ig-sexo">
              <option value="M">Masculino</option>
              <option value="F">Feminino</option>
            </select>
          </div>
          <div>
            <label>IG ao nascer (semanas)</label>
            <input type="number" id="neo-lub-ig-sem" min="24" max="44" step="1">
          </div>
          <div>
            <label>IG ao nascer (dias)</label>
            <input type="number" id="neo-lub-ig-dias" min="0" max="6" step="1">
          </div>
        </div>

        <label>Peso ao nascer (g)</label>
        <input type="number" id="neo-lub-peso" min="200" step="1">

        <button class="calc-btn" onclick="calcIntergrowthPIG()">Classificar (PIG/AIG/GIG)</button>
        <div id="res-neo-lub" class="result-box"></div>
      </div>

      <!-- 4) Icterícia neonatal -->
      <div class="card">
        <div class="card-header"><h2>Icterícia Neonatal (parâmetros SBP)</h2></div>

        <div class="grid-2">
          <div><label>IG (semanas)</label><input type="number" id="ict-ig" min="24" step="1"></div>
          <div><label>Horas de vida</label><input type="number" id="ict-horas" min="0" step="1"></div>
        </div>

        <label>Bilirrubina Total (mg/dL)</label>
        <input type="number" id="ict-bt" step="0.1" min="0">

        <label>Fatores de risco (marque os presentes)</label>
        <div style="margin-top:8px">
          <label style="font-weight:600;color:#2c3e50"><input type="checkbox" class="ict-risk" value="hemolise"> Hemólise (ABO/Rh, Coombs +, G6PD, etc.)</label>
          <label style="font-weight:600;color:#2c3e50"><input type="checkbox" class="ict-risk" value="sepse"> Sepse/instabilidade clínica</label>
          <label style="font-weight:600;color:#2c3e50"><input type="checkbox" class="ict-risk" value="prematuro"> Prematuridade/idade gestacional limítrofe</label>
          <label style="font-weight:600;color:#2c3e50"><input type="checkbox" class="ict-risk" value="albumina"> Hipoalbuminemia (se aplicável)</label>
        </div>

        <button class="calc-btn" onclick="calcIctericiaSBP2021()">Avaliar Conduta</button>
        <div id="res-ict" class="result-box"></div>

        <div class="muted warn">
          ATUALIZAR_CONFORME_SBP: este bloco está pronto para receber os limiares/tabelas SBP (fototerapia/exsanguíneo) por IG e horas de vida.
        </div>
      </div>

    </div>

    <!-- ========================= -->
    <!-- ABA CRESCIMENTO (ORDEM)  -->
    <!-- ========================= -->
    <div id="tab-cresc" class="tab-content">

      <!-- 1) Bloco único: velocidades -->
      <div class="card">
        <div class="card-header"><h2>Velocidades (PC, Peso, Estatura) — bloco único</h2></div>

        <div class="grid-2">
          <div><label>Data inicial</label><input type="date" id="cr-data-i"></div>
          <div><label>Data final</label><input type="date" id="cr-data-f"></div>
        </div>

        <div class="grid-3">
          <div>
            <label>PC inicial (cm)</label>
            <input type="number" id="cr-pc-i" step="0.1">
          </div>
          <div>
            <label>PC final (cm)</label>
            <input type="number" id="cr-pc-f" step="0.1">
          </div>
          <div>
            <label>Idade (meses) (p/ referência)</label>
            <input type="number" id="cr-idade-meses" step="0.1" min="0">
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label>Peso inicial</label>
            <input type="number" id="cr-peso-i" step="1">
          </div>
          <div>
            <label>Peso final</label>
            <input type="number" id="cr-peso-f" step="1">
          </div>
        </div>

        <label>Unidade do peso</label>
        <select id="cr-peso-unid">
          <option value="g">g</option>
          <option value="kg">kg</option>
        </select>

        <div class="grid-2">
          <div>
            <label>Estatura inicial (cm)</label>
            <input type="number" id="cr-alt-i" step="0.1">
          </div>
          <div>
            <label>Estatura final (cm)</label>
            <input type="number" id="cr-alt-f" step="0.1">
          </div>
        </div>

        <button class="calc-btn" onclick="calcVelocidadesCrescimento()">Calcular velocidades</button>

        <div id="res-cr-peso" class="result-box"></div>
        <div id="res-cr-pc" class="result-box"></div>
        <div id="res-cr-alt" class="result-box"></div>

        <div id="ref-cr" class="result-box"></div>
      </div>

      <!-- 2) Alvo parental + idade óssea + análise -->
      <div class="card">
        <div class="card-header"><h2>Alvo parental + Idade óssea + Análise integrada</h2></div>

        <div class="grid-2">
          <div><label>Altura do pai (cm)</label><input type="number" id="ap-pai" step="0.1"></div>
          <div><label>Altura da mãe (cm)</label><input type="number" id="ap-mae" step="0.1"></div>
        </div>

        <label>Sexo da criança</label>
        <select id="ap-sexo">
          <option value="M">Masculino</option>
          <option value="F">Feminino</option>
        </select>

        <div class="grid-2">
          <div><label>Altura atual (cm)</label><input type="number" id="ap-alt-atual" step="0.1"></div>
          <div><label>Idade cronológica (anos)</label><input type="number" id="ap-idade" step="0.1"></div>
        </div>

        <label>Idade óssea (anos) (entrada manual)</label>
        <input type="number" id="ap-io" step="0.1">

        <button class="calc-btn" onclick="calcAlvoParentalEAnalise()">Calcular e analisar</button>
        <div id="res-ap" class="result-box"></div>

        <div class="muted">
          ⚠️ Idade óssea aqui é <b>input clínico</b> (ex.: Greulich &amp; Pyle). A interpretação avançada fica como placeholder para você definir regra.
        </div>
      </div>

    </div>

    <!-- ========================= -->
    <!-- ABA CARDIO (ORDEM)       -->
    <!-- ========================= -->
    <div id="tab-cardio" class="tab-content">

      <div class="subnav">
        <button class="active" onclick="openCardioSub('cardio-main', this)">Calculadoras</button>
        <button class="nav-btn" onclick="openCardioSub('cardio-mrpa')">MRPA (PA)</button>
      </div>

      <!-- SUB-ABA: conteúdo normal do Cardio -->
      <div id="cardio-main" class="cardio-sub active">

        <!-- 1) Avaliação de ECG -->
        <div class="card">
          <div class="card-header" style="border-color:var(--cardio)"><h2>Avaliação de ECG</h2></div>

          <p class="muted">Use quadradinhos: 1mm = 0,04s (25 mm/s). Se preferir, informe RR em quadradinhos.</p>

          <div class="grid-2">
            <div><label>QT (quadradinhos)</label><input type="number" id="ecg-qt-q" step="1" min="1"></div>
            <div><label>RR (quadradinhos)</label><input type="number" id="ecg-rr-q" step="1" min="1"></div>
          </div>

          <button class="calc-btn" style="background:var(--cardio)" onclick="calcECG()">Analisar ECG (QTc + FC)</button>
          <div id="res-ecg" class="result-box"></div>

          <div class="muted warn">
            Intervalos/eixo por idade: placeholder (não inserir tabela sem fonte). Estrutura pronta para você preencher.
          </div>
        </div>

        <!-- 2) Classificação PA pediatria e adulto -->
        <div class="card">
          <div class="card-header" style="border-color:var(--cardio)"><h2>Classificação de Pressão Arterial (Pediatria e Adulto)</h2></div>

          <div class="grid-2">
            <div><label>PAS (mmHg)</label><input type="number" id="pa-pas" step="1"></div>
            <div><label>PAD (mmHg)</label><input type="number" id="pa-pad" step="1"></div>
          </div>

          <div class="grid-2">
            <div><label>Idade (anos)</label><input type="number" id="pa-idade" step="0.1"></div>
            <div>
              <label>Sexo</label>
              <select id="pa-sexo">
                <option value="M">Masculino</option>
                <option value="F">Feminino</option>
              </select>
            </div>
          </div>

          <label>Estatura (cm) ou Percentil de estatura (se você já tiver)</label>
          <input type="number" id="pa-estatura" step="0.1">

          <button class="calc-btn" style="background:var(--cardio)" onclick="classificarPA()">Classificar PA</button>
          <div id="res-pa" class="result-box"></div>

          <div class="muted warn">
            Pediatria (SBP): precisa de <b>tabela percentílica por idade/sexo/estatura</b>. O código está preparado para plugar.
          </div>
        </div>

      </div><!-- /#cardio-main -->

      <!-- SUB-ABA: MRPA -->
   <div id="cardio-mrpa" class="cardio-sub">
  <div class="card" id="mrpa-print-area">

    <div class="mrpa-toolbar" style="display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <select id="mrpa-paper" onchange="setMRPAPaperSize()"
                style="padding:10px 12px;border-radius:10px;border:1px solid #dce4ec;font-weight:700">
          <option value="A4">Papel: A4</option>
          <option value="A5">Papel: A5</option>
        </select>

        <button class="calc-btn" style="background:var(--cardio); width:auto; padding:12px 14px" onclick="printMRPA()">
          Imprimir MRPA
        </button>
      </div>

      <div class="muted" style="margin:0">Imprime em branco para preenchimento manual.</div>
    </div>

    <!-- Cabeçalho -->
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;padding:8px 0 10px;border-bottom:2px solid rgba(40,90,129,0.18)">
      <div>
        <div style="font-family:'Comfortaa',cursive;font-weight:800;color:var(--primary);font-size:1.05rem">PueriCalc • MRPA</div>
        <div style="color:#52616d;font-size:0.78rem">Monitorização Residencial da Pressão Arterial</div>
      </div>
      <div style="text-align:right;color:#52616d;font-size:0.78rem;line-height:1.25">
        <div><b>Orientação:</b> 1º dia (clínica) 2 medições. 2º ao 5º dia: 3 manhã + 3 noite.</div>
        <div>Registrar PAS, PAD e Pulso em cada medição.</div>
      </div>
    </div>

    <!-- Dados gerais -->
    <div class="card" style="box-shadow:none;border:1px solid rgba(0,0,0,0.10);margin-top:12px">
      <div class="mrpa-grid-2">
        <div>
          <div class="mrpa-label">Nome</div><div class="mrpa-box"></div>
        </div>
        <div>
          <div class="mrpa-label">Data de nascimento</div><div class="mrpa-box"></div>
        </div>
        <div>
          <div class="mrpa-label">Peso (kg)</div><div class="mrpa-box"></div>
        </div>
        <div>
          <div class="mrpa-label">Altura (m)</div><div class="mrpa-box"></div>
        </div>
        <div>
          <div class="mrpa-label">Médico(a)</div><div class="mrpa-box"></div>
        </div>
        <div>
          <div class="mrpa-label">Clínica</div><div class="mrpa-box"></div>
        </div>
      </div>
    </div>

    <!-- Medicações -->
    <div class="card" style="box-shadow:none;border:1px solid rgba(0,0,0,0.10)">
      <div class="mrpa-row-title">Medicações em uso</div>
      <div class="mrpa-box big"></div>
    </div>

    <!-- Dia 1 -->
    <div class="card" style="box-shadow:none;border:1px solid rgba(0,0,0,0.10)">
      <div class="mrpa-row-title">1º Dia – Clínica (____ / ____ / ____)</div>
      <div class="mrpa-grid-2">
        <div class="mrpa-medicao">
          <div class="mrpa-row-title" style="font-size:0.9rem">1ª Medição</div>
          <div class="mrpa-label">Hora</div><div class="mrpa-box"></div>
          <div class="mrpa-label">PAS</div><div class="mrpa-box"></div>
          <div class="mrpa-label">PAD</div><div class="mrpa-box"></div>
          <div class="mrpa-label">Pulso</div><div class="mrpa-box"></div>
        </div>
        <div class="mrpa-medicao">
          <div class="mrpa-row-title" style="font-size:0.9rem">2ª Medição</div>
          <div class="mrpa-label">Hora</div><div class="mrpa-box"></div>
          <div class="mrpa-label">PAS</div><div class="mrpa-box"></div>
          <div class="mrpa-label">PAD</div><div class="mrpa-box"></div>
          <div class="mrpa-label">Pulso</div><div class="mrpa-box"></div>
        </div>
      </div>
    </div>

    <!-- Dias 2 a 5 -->
    <div id="mrpa-dias"></div>

    <!-- Rodapé (para assinatura) -->
    <div style="margin-top:14px;padding-top:10px;border-top:2px solid rgba(40,90,129,0.18);display:flex;justify-content:flex-end">
      <div style="text-align:right;font-size:0.82rem;line-height:1.25;color:#1f2d3a;font-weight:700">
        <div style="font-weight:600;color:#52616d;font-size:0.78rem" id="mrpa-local-data">Local, ____/____/______</div>
        <div style="margin-top:4px">__________________________________________</div>
        <div style="font-weight:600;color:#52616d;font-size:0.78rem">Médico(a) • CRM</div>
      </div>
    </div>

  </div>
</div>

    <!-- ========================= -->
    <!-- ABA EMERGÊNCIA (ORDEM)   -->
    <!-- ========================= -->
    <div id="tab-emerg" class="tab-content">

      <div class="card">
        <div class="card-header" style="border-color:var(--emergency)"><h2>Dados do paciente (base)</h2></div>
        <div class="grid-2">
          <div><label>Peso (kg)</label><input type="number" id="em-peso" step="0.1" min="0"></div>
          <div><label>Idade (anos)</label><input type="number" id="em-idade" step="0.1" min="0"></div>
        </div>
        <div class="muted">Os subitens abaixo usam este peso/idade como fonte única (reduz erro operacional).</div>
      </div>

      <!-- 4.1 PCR e pós PCR -->
      <div class="card">
        <div class="card-header" style="border-color:var(--emergency)"><h2>4.1 PCR e Pós-PCR</h2></div>

        <label>Subitem</label>
        <select id="em-41">
          <option value="rcp">Ressuscitação Cardiopulmonar</option>
          <option value="sri">Sequência Rápida de Intubação</option>
          <option value="tubo">Tamanho do tubo e posição de fixação</option>
        </select>

        <button class="calc-btn" style="background:var(--emergency)" onclick="calcEmerg41()">Gerar</button>
        <div id="res-em-41" class="result-box"></div>

        <div class="muted warn">Doses e limites: prontos para você ajustar conforme protocolo institucional/AHA/SBP (sem inventar).</div>
      </div>

      <!-- 4.2 Sedação e analgesia -->
      <div class="card">
        <div class="card-header" style="border-color:var(--emergency)"><h2>4.2 Sedação e analgesia</h2></div>

        <label>Subitem</label>
        <select id="em-42">
          <option value="proced">Para procedimentos</option>
          <option value="cont">Contínua</option>
        </select>

        <button class="calc-btn" style="background:var(--emergency)" onclick="calcEmerg42()">Gerar</button>
        <div id="res-em-42" class="result-box"></div>
      </div>

      <!-- 4.3 Urgências neurológicas -->
      <div class="card">
        <div class="card-header" style="border-color:var(--emergency)"><h2>4.3 Urgências neurológicas</h2></div>

        <label>Subitem</label>
        <select id="em-43">
          <option value="crise">Crise convulsiva</option>
          <option value="status">Status convulsivo</option>
          <option value="hic">Hipertensão intracraniana</option>
        </select>

        <button class="calc-btn" style="background:var(--emergency)" onclick="calcEmerg43()">Gerar</button>
        <div id="res-em-43" class="result-box"></div>
      </div>

      <!-- 4.4 Distúrbio de ritmos -->
      <div class="card">
        <div class="card-header" style="border-color:var(--emergency)"><h2>4.4 Distúrbio de ritmos</h2></div>

        <label>Subitem</label>
        <select id="em-44">
          <option value="chocaveis">Chocáveis (tipos de ritmo e dose)</option>
          <option value="nao">Não chocáveis (tipos, medicamentos e doses)</option>
        </select>

        <button class="calc-btn" style="background:var(--emergency)" onclick="calcEmerg44()">Gerar</button>
        <div id="res-em-44" class="result-box"></div>
      </div>

      <!-- 4.5 Choques -->
      <div class="card">
        <div class="card-header" style="border-color:var(--emergency)"><h2>4.5 Choques (tipos, medicamentos e doses)</h2></div>

        <label>Tipo de choque</label>
        <select id="em-45">
          <option value="hipov">Hipovolêmico</option>
          <option value="sept">Séptico</option>
          <option value="ana">Anafilático</option>
          <option value="card">Cardiogênico</option>
        </select>

        <button class="calc-btn" style="background:var(--emergency)" onclick="calcEmerg45()">Gerar</button>
        <div id="res-em-45" class="result-box"></div>
      </div>
    </div>

    <!-- ========================= -->
    <!-- ABA HIDRATAÇÃO (ORDEM)   -->
    <!-- ========================= -->
    <div id="tab-hidra" class="tab-content">

      <!-- Holliday-Segar -->
      <div class="card">
        <div class="card-header" style="border-color:var(--renal)"><h2>Holliday-Segar (com eletrólitos)</h2></div>

        <label>Peso (kg)</label>
        <input type="number" id="hs-peso" step="0.1" min="0">

        <label>Modo eletrólitos</label>
        <select id="hs-modo">
          <option value="meqkg">mEq/kg/dia</option>
          <option value="meql">mEq/L (solução final)</option>
        </select>

        <div class="grid-2">
          <div><label>Na+</label><input type="number" id="hs-na" step="0.1"></div>
          <div><label>K+</label><input type="number" id="hs-k" step="0.1"></div>
        </div>
        <div class="grid-2">
          <div><label>Cl-</label><input type="number" id="hs-cl" step="0.1"></div>
          <div><label>Glicose (g/L ou g/kg/dia)</label><input type="number" id="hs-glic" step="0.1"></div>
        </div>

        <button class="calc-btn" style="background:var(--renal)" onclick="calcHollidaySegar()">Calcular manutenção</button>
        <div id="res-hs" class="result-box"></div>
      </div>

      <!-- VIG -->
      <div class="card">
        <div class="card-header" style="border-color:var(--renal)"><h2>VIG (com eletrólitos)</h2></div>

        <div class="grid-2">
          <div><label>Peso (kg)</label><input type="number" id="vig-peso" step="0.1" min="0"></div>
          <div><label>VIG alvo (mL/kg/h)</label><input type="number" id="vig-alvo" step="0.1" value="4"></div>
        </div>

        <div class="grid-2">
          <div><label>Na+ (mEq/L)</label><input type="number" id="vig-na" step="0.1"></div>
          <div><label>K+ (mEq/L)</label><input type="number" id="vig-k" step="0.1"></div>
        </div>
        <div class="grid-2">
          <div><label>Cl- (mEq/L)</label><input type="number" id="vig-cl" step="0.1"></div>
          <div><label>Glicose (g/L)</label><input type="number" id="vig-glic" step="0.1"></div>
        </div>

        <button class="calc-btn" style="background:var(--renal)" onclick="calcVIG()">Calcular VIG</button>
        <div id="res-vig" class="result-box"></div>
      </div>

      <!-- Schwartz (ok) -->
      <div class="card">
        <div class="card-header" style="border-color:var(--renal)"><h2>Clearance de Schwartz (eTFG)</h2></div>
        <div class="grid-2">
          <div><label>Creatinina (mg/dL)</label><input type="number" id="ren-cr" step="0.01"></div>
          <div><label>Estatura (cm)</label><input type="number" id="ren-alt" step="0.1"></div>
        </div>
        <button class="calc-btn" style="background:var(--renal)" onclick="calcSchwartz()">Calcular eTFG</button>
        <div id="res-renal" class="result-box"></div>
      </div>
    </div>

    <!-- ========================= -->
    <!-- ABA LABORATÓRIOS (ORDEM) -->
    <!-- ========================= -->
    <div id="tab-lab" class="tab-content">

      <!-- Gasometria com conduta -->
      <div class="card">
        <div class="card-header" style="border-color:var(--lab)"><h2>Gasometria (análise + conduta)</h2></div>

        <div class="grid-2">
          <div><label>pH</label><input type="number" id="g-ph" step="0.01"></div>
          <div><label>pCO2 (mmHg)</label><input type="number" id="g-pco2" step="0.1"></div>
        </div>

        <div class="grid-2">
          <div><label>HCO3- (mEq/L)</label><input type="number" id="g-hco3" step="0.1"></div>
          <div><label>Na+ (mEq/L)</label><input type="number" id="g-na" step="0.1"></div>
        </div>

        <div class="grid-2">
          <div><label>Cl- (mEq/L)</label><input type="number" id="g-cl" step="0.1"></div>
          <div><label>Albumina (g/dL) (opcional)</label><input type="number" id="g-alb" step="0.1"></div>
        </div>

        <button class="calc-btn" style="background:var(--lab)" onclick="calcGasoConduta()">Analisar</button>
        <div id="res-gaso" class="result-box"></div>

        <div class="muted warn">Condutas são orientativas. Ajuste conforme contexto clínico e protocolos locais.</div>
      </div>

      <!-- Conversão de unidades (ok) -->
      <div class="card">
        <div class="card-header" style="border-color:var(--lab)"><h2>Conversor de Unidades</h2></div>
        <select id="lab-conv">
          <option value="0.2495">Cálcio (mg/dL -> mmol/L)</option>
          <option value="88.4">Creatinina (mg/dL -> umol/L)</option>
          <option value="17.1">Bilirrubina (mg/dL -> umol/L)</option>
        </select>
        <input type="number" id="lab-val" placeholder="Valor convencional" style="margin-top:10px">
        <button class="calc-btn" style="background:var(--lab)" onclick="convertLab()">Converter</button>
        <div id="res-lab" class="result-box"></div>
      </div>
    </div>

    <!-- ========================= -->
    <!-- ABA CHECKLIST            -->
    <!-- ========================= -->
    <div id="tab-check" class="tab-content">
      <div class="card">
        <div class="card-header" style="border-color:var(--check)"><h2>Puericultura Inteligente</h2></div>
        <label>Idade da Consulta</label>
        <select id="ck-idade" onchange="renderCheck()">
          <option value="">Selecione...</option>
          <option value="2">2 Meses</option>
          <option value="6">6 Meses</option>
          <option value="12">12 Meses</option>
        </select>
        <div id="check-area" style="margin-top:15px"></div>
      </div>
    </div>

    <!-- BIBLIOGRAFIA -->
    <div class="card">
      <h3 style="font-size:0.9rem">Bibliografia de Referência</h3>
      <ul style="font-size:0.75rem; color:#7f8c8d; padding-left:15px">
        <li>SBP - Diretrizes (inserir versão/ano conforme uso)</li>
        <li>OMS - Growth Standards (2006)</li>
        <li>AHA - PALS Guidelines (ajustar versão conforme protocolo)</li>
        <li>Schwartz GJ, et al. (2009)</li>
      </ul>
    </div>

  </div>

  <footer>Versão de trabalho • Estruturas prontas para atualização conforme SBP/SBC • Offline-friendly</footer>

  <script>
    // =========================
    // UTILITÁRIOS
    // =========================
    function openTab(tabId, btnEl) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      const t = document.getElementById(tabId);
      if (!t) return;
      t.classList.add('active');

      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      if (btnEl) btnEl.classList.add('active');

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Sub-abas do Cardio (MRPA)
    function openCardioSub(subId, btnEl){
      document.querySelectorAll('#tab-cardio .cardio-sub').forEach(el => el.classList.remove('active'));
      const target = document.getElementById(subId);
      if (target) target.classList.add('active');

      document.querySelectorAll('#tab-cardio .subnav button').forEach(b => b.classList.remove('active'));
      if (btnEl) btnEl.classList.add('active');

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showResult(elId, text) {
      const el = document.getElementById(elId);
      if (!el) return;
      el.style.display = 'block';
      el.textContent = text;
    }

    function showResultHTML(elId, text) {
      const el = document.getElementById(elId);
      if (!el) return;
      el.style.display = 'block';
      el.innerHTML = text;
    }

    function parseDate(v) {
      if (!v) return null;
      const d = new Date(v + "T00:00:00");
      return isNaN(d.getTime()) ? null : d;
    }

    function diffDays(d1, d2) {
      return Math.floor((d2.getTime() - d1.getTime()) / (1000 * 60 * 60 * 24));
    }

    function weeksDaysFromTotalDays(totalDays) {
      const w = Math.floor(totalDays / 7);
      const d = totalDays % 7;
      return { w, d };
    }

    // =========================
    // 1) NEONATO
    // =========================
    function toggleNeoInput() {
      const modo = document.getElementById('neo-modo').value;
      document.getElementById('box-dum').style.display = (modo === 'dum') ? 'block' : 'none';
      document.getElementById('box-usg').style.display = (modo === 'usg') ? 'block' : 'none';
    }

    function calcNeoIG() {
      const modo = document.getElementById('neo-modo').value;
      const dataCalc = parseDate(document.getElementById('neo-ig-calc').value);
      if (!dataCalc) return showResult('res-neo-ig', 'Informe a data para cálculo.');

      let dpp = null;
      let igDias = null;

      if (modo === 'dum') {
        const dum = parseDate(document.getElementById('neo-dum').value);
        if (!dum) return showResult('res-neo-ig', 'Informe a data da DUM.');

        igDias = diffDays(dum, dataCalc);
        dpp = new Date(dum.getTime());
        dpp.setDate(dpp.getDate() + 280);
      } else {
        const usgData = parseDate(document.getElementById('neo-usg-data').value);
        const sem = Number(document.getElementById('neo-usg-sem').value);
        const dias = Number(document.getElementById('neo-usg-dias').value);

        if (!usgData) return showResult('res-neo-ig', 'Informe a data do USG.');
        if (!Number.isFinite(sem) || sem < 0) return showResult('res-neo-ig', 'Informe semanas do USG.');
        if (!Number.isFinite(dias) || dias < 0 || dias > 6) return showResult('res-neo-ig', 'Dias do USG deve estar entre 0 e 6.');

        const gestDaysAtUSG = (sem * 7) + dias;
        const dumEst = new Date(usgData.getTime());
        dumEst.setDate(dumEst.getDate() - gestDaysAtUSG);

        igDias = diffDays(dumEst, dataCalc);
        dpp = new Date(dumEst.getTime());
        dpp.setDate(dpp.getDate() + 280);
      }

      if (igDias < 0) return showResult('res-neo-ig', 'A data para cálculo é anterior ao início da gestação estimado.');

      const wd = weeksDaysFromTotalDays(igDias);
      const msg =
        `IG na data informada: ${wd.w} semanas e ${wd.d} dias\n` +
        `DPP estimada: ${dpp.toLocaleDateString('pt-BR')}`;
      showResult('res-neo-ig', msg);
    }

    function calcIGCorrigidaPosNatal() {
      const sem = Number(document.getElementById('neo-ig-nasc-sem').value);
      const dias = Number(document.getElementById('neo-ig-nasc-dias').value);
      const dn = parseDate(document.getElementById('neo-data-nasc').value);
      const dc = parseDate(document.getElementById('neo-data-posnatal').value);

      if (!Number.isFinite(sem) || sem < 0) return showResult('res-neo-igcorr', 'Informe IG ao nascimento (semanas).');
      if (!Number.isFinite(dias) || dias < 0 || dias > 6) return showResult('res-neo-igcorr', 'Dias ao nascimento deve estar entre 0 e 6.');
      if (!dn) return showResult('res-neo-igcorr', 'Informe a data de nascimento.');
      if (!dc) return showResult('res-neo-igcorr', 'Informe a data para cálculo.');

      const posDays = diffDays(dn, dc);
      if (posDays < 0) return showResult('res-neo-igcorr', 'Data para cálculo não pode ser anterior ao nascimento.');

      const igTotalDays = (sem * 7) + dias + posDays;
      const wd = weeksDaysFromTotalDays(igTotalDays);

      showResult('res-neo-igcorr', `IG corrigida: ${wd.w} semanas e ${wd.d} dias\nTempo pós-natal considerado: ${posDays} dia(s)`);
    }

    // =========================
    // INTERGROWTH-21st — PIG/AIG/GIG (P10/P90)
    // =========================
    const INTERGROWTH_P10_P90 = {
      boys:  { veryPreterm: {}, newborn: {} },
      girls: { veryPreterm: {}, newborn: {} }
    };

    (function(){
      const GA=["33+0","33+1","33+2","33+3","33+4","33+5","33+6","34+0","34+1","34+2","34+3","34+4","34+5","34+6","35+0","35+1","35+2","35+3","35+4","35+5","35+6","36+0","36+1","36+2","36+3","36+4","36+5","36+6","37+0","37+1","37+2","37+3","37+4","37+5","37+6","38+0","38+1","38+2","38+3","38+4","38+5","38+6","39+0","39+1","39+2","39+3","39+4","39+5","39+6","40+0","40+1","40+2","40+3","40+4","40+5","40+6","41+0","41+1","41+2","41+3","41+4","41+5","41+6","42+0","42+1","42+2","42+3","42+4","42+5","42+6"];
      const P10=[1.43,1.47,1.51,1.55,1.59,1.63,1.67,1.71,1.74,1.78,1.82,1.85,1.89,1.92,1.95,1.99,2.02,2.05,2.09,2.12,2.15,2.18,2.21,2.24,2.27,2.30,2.33,2.36,2.38,2.41,2.44,2.47,2.49,2.52,2.54,2.57,2.59,2.62,2.64,2.67,2.69,2.71,2.73,2.76,2.78,2.80,2.82,2.84,2.86,2.88,2.90,2.92,2.94,2.96,2.98,2.99,3.01,3.03,3.05,3.06,3.08,3.09,3.11,3.12,3.14,3.15,3.17,3.18,3.20,3.21];
      const P90=[2.52,2.56,2.60,2.64,2.67,2.71,2.75,2.79,2.82,2.86,2.89,2.93,2.96,3.00,3.03,3.06,3.09,3.13,3.16,3.19,3.22,3.25,3.28,3.31,3.34,3.37,3.39,3.42,3.45,3.48,3.50,3.53,3.55,3.58,3.61,3.63,3.65,3.68,3.70,3.72,3.75,3.77,3.79,3.81,3.83,3.86,3.88,3.90,3.92,3.94,3.95,3.97,3.99,4.01,4.03,4.04,4.06,4.08,4.09,4.11,4.13,4.14,4.16,4.17,4.19,4.20,4.21,4.23,4.24,4.25];
      for (let i=0;i<GA.length;i++) INTERGROWTH_P10_P90.boys.newborn[GA[i]]={p10:P10[i],p90:P90[i]};
    })();

    (function(){
      const GA=["24+0","24+1","24+2","24+3","24+4","24+5","24+6","25+0","25+1","25+2","25+3","25+4","25+5","25+6","26+0","26+1","26+2","26+3","26+4","26+5","26+6","27+0","27+1","27+2","27+3","27+4","27+5","27+6","28+0","28+1","28+2","28+3","28+4","28+5","28+6","29+0","29+1","29+2","29+3","29+4","29+5","29+6","30+0","30+1","30+2","30+3","30+4","30+5","30+6","31+0","31+1","31+2","31+3","31+4","31+5","31+6","32+0","32+1","32+2","32+3","32+4","32+5","32+6"];
      const P10=[0.5,0.51,0.52,0.53,0.54,0.55,0.56,0.57,0.58,0.59,0.6,0.61,0.63,0.64,0.65,0.66,0.67,0.69,0.7,0.71,0.72,0.74,0.75,0.77,0.78,0.79,0.81,0.82,0.84,0.85,0.87,0.88,0.9,0.92,0.93,0.95,0.97,0.98,1,1.02,1.03,1.05,1.07,1.09,1.11,1.13,1.15,1.17,1.19,1.21,1.23,1.25,1.27,1.29,1.31,1.34,1.36,1.38,1.41,1.43,1.45,1.48,1.5];
      const P90=[0.82,0.83,0.85,0.87,0.88,0.9,0.92,0.93,0.95,0.97,0.99,1.01,1.03,1.04,1.06,1.08,1.1,1.13,1.15,1.17,1.19,1.21,1.23,1.26,1.28,1.3,1.33,1.35,1.37,1.4,1.42,1.45,1.48,1.5,1.53,1.56,1.58,1.61,1.64,1.67,1.7,1.73,1.76,1.79,1.82,1.85,1.88,1.92,1.95,1.98,2.02,2.05,2.09,2.12,2.16,2.19,2.23,2.27,2.31,2.35,2.38,2.42,2.46];
      for (let i=0;i<GA.length;i++) INTERGROWTH_P10_P90.boys.veryPreterm[GA[i]]={p10:P10[i],p90:P90[i]};
    })();

    (function(){
      const GA=["24+0","24+1","24+2","24+3","24+4","24+5","24+6","25+0","25+1","25+2","25+3","25+4","25+5","25+6","26+0","26+1","26+2","26+3","26+4","26+5","26+6","27+0","27+1","27+2","27+3","27+4","27+5","27+6","28+0","28+1","28+2","28+3","28+4","28+5","28+6","29+0","29+1","29+2","29+3","29+4","29+5","29+6","30+0","30+1","30+2","30+3","30+4","30+5","30+6","31+0","31+1","31+2","31+3","31+4","31+5","31+6","32+0","32+1","32+2","32+3","32+4","32+5","32+6"];
      const P10=[0.47,0.48,0.49,0.5,0.51,0.52,0.53,0.54,0.55,0.56,0.57,0.58,0.59,0.6,0.61,0.62,0.64,0.65,0.66,0.67,0.68,0.7,0.71,0.72,0.74,0.75,0.76,0.78,0.79,0.81,0.82,0.83,0.85,0.86,0.88,0.9,0.91,0.93,0.94,0.96,0.98,0.99,1.01,1.03,1.05,1.07,1.08,1.1,1.12,1.14,1.16,1.18,1.2,1.22,1.24,1.26,1.28,1.31,1.33,1.35,1.37,1.4,1.42];
      const P90=[0.77,0.79,0.8,0.82,0.83,0.85,0.87,0.88,0.9,0.92,0.93,0.95,0.97,0.99,1.01,1.02,1.04,1.06,1.08,1.1,1.12,1.14,1.16,1.19,1.21,1.23,1.25,1.27,1.3,1.32,1.34,1.37,1.39,1.42,1.44,1.47,1.5,1.52,1.55,1.58,1.6,1.63,1.66,1.69,1.72,1.75,1.78,1.81,1.84,1.87,1.9,1.94,1.97,2,2.04,2.07,2.11,2.14,2.18,2.21,2.25,2.29,2.33];
      for (let i=0;i<GA.length;i++) INTERGROWTH_P10_P90.girls.veryPreterm[GA[i]]={p10:P10[i],p90:P90[i]};
    })();

    (function(){
      const GA=["36+0","36+1","36+2","36+3","36+4","36+5","36+6","37+0","37+1","37+2","37+3","37+4","37+5","37+6","38+0","38+1","38+2","38+3","38+4","38+5","38+6","39+0","39+1","39+2","39+3","39+4","39+5","39+6","40+0","40+1","40+2","40+3","40+4","40+5","40+6","41+0","41+1","41+2","41+3","41+4","41+5","41+6","42+0","42+1","42+2","42+3","42+4","42+5","42+6"];
      const P10=[2.14,2.17,2.20,2.23,2.25,2.28,2.31,2.33,2.36,2.38,2.41,2.43,2.46,2.48,2.50,2.53,2.55,2.57,2.59,2.61,2.63,2.65,2.67,2.69,2.71,2.73,2.74,2.76,2.78,2.80,2.81,2.83,2.84,2.86,2.87,2.89,2.90,2.91,2.93,2.94,2.95,2.96,2.98,2.99,3.00,3.01,3.02,3.03,3.04];
      const P90=[3.12,3.15,3.18,3.21,3.24,3.27,3.30,3.32,3.35,3.38,3.40,3.43,3.46,3.48,3.51,3.53,3.55,3.58,3.60,3.62,3.64,3.66,3.68,3.70,3.72,3.74,3.76,3.78,3.80,3.82,3.84,3.85,3.87,3.89,3.90,3.92,3.93,3.95,3.96,3.97,3.99,4.00,4.01,4.03,4.04,4.05,4.06,4.07,4.08];
      for (let i=0;i<GA.length;i++) INTERGROWTH_P10_P90.girls.newborn[GA[i]]={p10:P10[i],p90:P90[i]};
    })();

    function igKey(sem, dias) { return `${sem}+${dias}`; }
    function pickIntergrowthDomain(sem, dias) {
      const totalDays = (sem * 7) + dias;
      const d24 = (24 * 7);
      const d33 = (33 * 7);
      const d42_6 = (42 * 7) + 6;
      if (totalDays < d24 || totalDays > d42_6) return { error: 'IG fora do intervalo INTERGROWTH (24+0 a 42+6).' };
      return { domain: (totalDays < d33) ? 'veryPreterm' : 'newborn' };
    }
    function classifyPIG_AIG_GIG(pesoG, p10Kg, p90Kg) {
      const pesoKg = pesoG / 1000;
      if (pesoKg < p10Kg) return 'PIG';
      if (pesoKg > p90Kg) return 'GIG';
      return 'AIG';
    }
    function calcIntergrowthPIG() {
      const sexo = document.getElementById('neo-ig-sexo').value; // M/F
      const igSem = Number(document.getElementById('neo-lub-ig-sem').value);
      const igDias = Number(document.getElementById('neo-lub-ig-dias').value);
      const pesoG = Number(document.getElementById('neo-lub-peso').value);

      if (!Number.isFinite(igSem) || igSem <= 0) return showResult('res-neo-lub', 'Informe IG (semanas).');
      if (!Number.isFinite(igDias) || igDias < 0 || igDias > 6) return showResult('res-neo-lub', 'Dias deve estar entre 0 e 6.');
      if (!Number.isFinite(pesoG) || pesoG <= 0) return showResult('res-neo-lub', 'Informe peso ao nascer (g).');

      const key = igKey(igSem, igDias);
      const pick = pickIntergrowthDomain(igSem, igDias);
      if (pick.error) return showResult('res-neo-lub', pick.error);

      const sexKey = (sexo === 'M') ? 'boys' : 'girls';
      const row = INTERGROWTH_P10_P90[sexKey][pick.domain][key];

      if (!row) {
        return showResult(
          'res-neo-lub',
          `Sem dados INTERGROWTH carregados para ${sexo === 'M' ? 'meninos' : 'meninas'} (${pick.domain}) na IG ${key}.`
        );
      }

      const cls = classifyPIG_AIG_GIG(pesoG, row.p10, row.p90);
      const msg =
        `INTERGROWTH-21st (${sexo === 'M' ? 'Meninos' : 'Meninas'} • ${pick.domain === 'veryPreterm' ? 'Very-Preterm' : 'Newborn'})\n` +
        `IG: ${key}\nPeso: ${pesoG} g (${(pesoG/1000).toFixed(3)} kg)\n\n` +
        `P10: ${row.p10.toFixed(2)} kg (${Math.round(row.p10*1000)} g)\n` +
        `P90: ${row.p90.toFixed(2)} kg (${Math.round(row.p90*1000)} g)\n\n` +
        `Classificação: ${cls}`;
      showResult('res-neo-lub', msg);
    }

    // =========================
    // ICTERÍCIA — SBP 2021 (parcial)
    // =========================
    const SBP2021_PRE35 = [
      { minGA: 0,     maxGA: 27.999, photo: [5, 6],  exch: [11, 14] },
      { minGA: 28.0,  maxGA: 29.999, photo: [6, 8],  exch: [12, 14] },
      { minGA: 30.0,  maxGA: 31.999, photo: [8, 10], exch: [13, 16] },
      { minGA: 32.0,  maxGA: 33.999, photo: [10,12], exch: [15, 18] },
      { minGA: 34.0,  maxGA: 34.999, photo: [10,12], exch: [17, 19] }
    ];
    function getRiskFlagIctericia() {
      const checks = Array.from(document.querySelectorAll('.ict-risk'));
      return checks.some(c => c.checked);
    }
    function pickThreshold(range, hasRisk) { return hasRisk ? range[0] : range[1]; }
    function findPre35Row(gaFloat) {
      return SBP2021_PRE35.find(r => gaFloat >= r.minGA && gaFloat <= r.maxGA) || null;
    }
    const SBP2021_GE35 = {
      groups: [
        { name: "35-37", minGA: 35, maxGA: 37.999, rows: [] },
        { name: ">=38",  minGA: 38, maxGA: 99,     rows: [] }
      ],
      hasRiskTable: false,
    };
    function findGE35Row(gaFloat, horas) {
      const grp = SBP2021_GE35.groups.find(g => gaFloat >= g.minGA && gaFloat <= g.maxGA);
      if (!grp) return null;
      const row = grp.rows.find(r => horas >= r.minH && horas <= r.maxH);
      return row ? { grp, row } : null;
    }
    function calcIctericiaSBP2021() {
      const igSem = Number(document.getElementById('ict-ig').value);
      const horas = Number(document.getElementById('ict-horas').value);
      const bt = Number(document.getElementById('ict-bt').value);

      if (!Number.isFinite(igSem) || igSem <= 0) return showResult('res-ict', 'Informe IG (semanas).');
      if (!Number.isFinite(horas) || horas < 0) return showResult('res-ict', 'Informe horas de vida.');
      if (!Number.isFinite(bt) || bt < 0) return showResult('res-ict', 'Informe bilirrubina total (mg/dL).');

      const hasRisk = getRiskFlagIctericia();
      const gaFloat = igSem;

      if (gaFloat < 35) {
        const row = findPre35Row(gaFloat);
        if (!row) return showResult('res-ict', 'Sem referência SBP 2021 (<35 semanas) para esta IG.');

        const thrPhoto = pickThreshold(row.photo, hasRisk);
        const thrExch  = pickThreshold(row.exch,  hasRisk);

        let conduta = 'Acompanhar e repetir BT conforme clínica.';
        if (bt >= thrExch) conduta = 'Exsanguineotransfusão: INDICAÇÃO (avaliar urgência; manter fototerapia intensiva enquanto prepara).';
        else if (bt >= thrPhoto) conduta = 'Fototerapia: INDICAÇÃO (preferir intensiva conforme contexto).';

        const msg =
          `SBP 2021 — RN <35 semanas (Tabela 10)\n` +
          `IG: ${igSem} sem | Horas: ${horas}h | Risco: ${hasRisk ? 'Sim (limite inferior)' : 'Não (limite superior)'}\n` +
          `BT: ${bt.toFixed(1)} mg/dL\n\n` +
          `Limiar fototerapia: ${thrPhoto.toFixed(1)} mg/dL\n` +
          `Limiar exsanguíneo: ${thrExch.toFixed(1)} mg/dL\n\n` +
          `Conduta: ${conduta}`;
        return showResult('res-ict', msg);
      }

      const hit = findGE35Row(gaFloat, horas);
      if (!hit) {
        return showResult(
          'res-ict',
          `SBP 2021 — RN ≥35 semanas\n` +
          `Tabela por horas/IG ainda não foi preenchida no código.\n\n` +
          `Preencha SBP2021_GE35.groups[].rows com os limiares oficiais do SBP 2021.`
        );
      }

      const thrPhoto = hit.row.photo;
      const thrExch = hit.row.exch;

      let conduta = 'Acompanhar e repetir BT conforme risco clínico.';
      if (bt >= thrExch) conduta = 'Exsanguineotransfusão: INDICAÇÃO (avaliar urgência).';
      else if (bt >= thrPhoto) conduta = 'Fototerapia: INDICAÇÃO.';

      const msg =
        `SBP 2021 — RN ≥35 semanas\n` +
        `Grupo IG: ${hit.grp.name}\n` +
        `Horas: ${horas}h | Risco: ${hasRisk ? 'Sim (implementar ajuste conforme SBP)' : 'Não'}\n` +
        `BT: ${bt.toFixed(1)} mg/dL\n\n` +
        `Limiar fototerapia: ${thrPhoto.toFixed(1)} mg/dL\n` +
        `Limiar exsanguíneo: ${thrExch.toFixed(1)} mg/dL\n\n` +
        `Conduta: ${conduta}`;
      return showResult('res-ict', msg);
    }

    // =========================
    // 2) CRESCIMENTO
    // =========================
    const REF_CRESC = {
      peso_g_dia: [
        { minM: 0, maxM: 3, ref: '20–30 g/dia (placeholder)' },
        { minM: 4, maxM: 6, ref: '20 g/dia (placeholder)' },
        { minM: 7, maxM: 9, ref: '15 g/dia (placeholder)' },
        { minM: 10, maxM: 12, ref: '10 g/dia (placeholder)' }
      ],
      pc_cm_mes: [
        { minM: 0, maxM: 3, ref: '≈ 2 cm/mês (placeholder)' },
        { minM: 4, maxM: 6, ref: '≈ 1 cm/mês (placeholder)' },
        { minM: 7, maxM: 12, ref: '≈ 0,5 cm/mês (placeholder)' }
      ],
      alt_cm_ano: [
        { minM: 0, maxM: 12, ref: '≈ 25 cm/ano (placeholder)' },
        { minM: 12, maxM: 24, ref: '≈ 12 cm/ano (placeholder)' },
        { minM: 24, maxM: 48, ref: '≈ 7–8 cm/ano (placeholder)' }
      ]
    };
    function pickRef(arr, idadeMeses) {
      const it = arr.find(x => idadeMeses >= x.minM && idadeMeses <= x.maxM);
      return it ? it.ref : 'Sem referência configurada para esta idade.';
    }
    function calcVelocidadesCrescimento() {
      const di = parseDate(document.getElementById('cr-data-i').value);
      const df = parseDate(document.getElementById('cr-data-f').value);
      const pc1 = Number(document.getElementById('cr-pc-i').value);
      const pc2 = Number(document.getElementById('cr-pc-f').value);
      const p1 = Number(document.getElementById('cr-peso-i').value);
      const p2 = Number(document.getElementById('cr-peso-f').value);
      const alt1 = Number(document.getElementById('cr-alt-i').value);
      const alt2 = Number(document.getElementById('cr-alt-f').value);
      const un = document.getElementById('cr-peso-unid').value;
      const idadeM = Number(document.getElementById('cr-idade-meses').value);

      if (!di || !df) return showResult('res-cr-peso', 'Informe as datas inicial e final.');
      const days = diffDays(di, df);
      if (days <= 0) return showResult('res-cr-peso', 'A data final deve ser maior que a inicial.');

      if (!Number.isFinite(p1) || !Number.isFinite(p2)) return showResult('res-cr-peso', 'Informe pesos inicial e final.');
      let p1g = (un === 'kg') ? p1 * 1000 : p1;
      let p2g = (un === 'kg') ? p2 * 1000 : p2;
      const ganhoGdia = (p2g - p1g) / days;

      if (!Number.isFinite(pc1) || !Number.isFinite(pc2)) return showResult('res-cr-pc', 'Informe PC inicial e final.');
      const months = days / 30.4375;
      const pcCmMes = (pc2 - pc1) / months;
      const pcCmSemana = (pc2 - pc1) / (days / 7);
      const pcCmAno = (pc2 - pc1) / (days / 365.25);

      if (!Number.isFinite(alt1) || !Number.isFinite(alt2)) return showResult('res-cr-alt', 'Informe estatura inicial e final.');
      const altCmAno = (alt2 - alt1) / (days / 365.25);

      showResult('res-cr-peso',
        `Ganho ponderal: ${ganhoGdia.toFixed(1)} g/dia\n` +
        `ΔPeso total: ${(p2g - p1g).toFixed(0)} g em ${days} dia(s)`
      );
      showResult('res-cr-pc',
        `Velocidade de PC:\n` +
        `${pcCmMes.toFixed(2)} cm/mês\n` +
        `${pcCmSemana.toFixed(2)} cm/semana\n` +
        `${pcCmAno.toFixed(2)} cm/ano\n` +
        `ΔPC total: ${(pc2 - pc1).toFixed(2)} cm`
      );
      showResult('res-cr-alt',
        `Velocidade de estatura:\n` +
        `${altCmAno.toFixed(2)} cm/ano\n` +
        `ΔEstatura total: ${(alt2 - alt1).toFixed(2)} cm`
      );

      const idadeRef = Number.isFinite(idadeM) ? idadeM : null;
      const refPeso = (idadeRef !== null) ? pickRef(REF_CRESC.peso_g_dia, idadeRef) : 'Informe idade (meses) para referência.';
      const refPC = (idadeRef !== null) ? pickRef(REF_CRESC.pc_cm_mes, idadeRef) : 'Informe idade (meses) para referência.';
      const refAlt = (idadeRef !== null) ? pickRef(REF_CRESC.alt_cm_ano, idadeRef) : 'Informe idade (meses) para referência.';

      showResult('ref-cr',
        `Referências (placeholders):\n` +
        `Peso (g/dia): ${refPeso}\n` +
        `PC (cm/mês): ${refPC}\n` +
        `Estatura (cm/ano): ${refAlt}\n\n` +
        `ATUALIZAR_CONFORME_REFERÊNCIA: edite REF_CRESC.`
      );
    }

    function calcAlvoParentalEAnalise() {
      const pai = Number(document.getElementById('ap-pai').value);
      const mae = Number(document.getElementById('ap-mae').value);
      const sexo = document.getElementById('ap-sexo').value;
      const altAtual = Number(document.getElementById('ap-alt-atual').value);
      const idade = Number(document.getElementById('ap-idade').value);
      const io = Number(document.getElementById('ap-io').value);

      if (!Number.isFinite(pai) || pai <= 0) return showResult('res-ap', 'Informe altura do pai.');
      if (!Number.isFinite(mae) || mae <= 0) return showResult('res-ap', 'Informe altura da mãe.');
      if (!Number.isFinite(altAtual) || altAtual <= 0) return showResult('res-ap', 'Informe altura atual.');
      if (!Number.isFinite(idade) || idade < 0) return showResult('res-ap', 'Informe idade cronológica.');

      const alvo = (sexo === 'M') ? ((pai + mae + 13) / 2) : ((pai + mae - 13) / 2);
      const faixaMin = alvo - 8.5;
      const faixaMax = alvo + 8.5;

      const dentro = (altAtual >= faixaMin && altAtual <= faixaMax);
      const delta = altAtual - alvo;

      let analise = `Alvo parental: ${alvo.toFixed(1)} cm\nFaixa esperada: ${faixaMin.toFixed(1)} a ${faixaMax.toFixed(1)} cm\n\n`;
      analise += `Altura atual: ${altAtual.toFixed(1)} cm\n`;
      analise += `Diferença vs alvo: ${delta.toFixed(1)} cm\n`;
      analise += `Interpretação: ${dentro ? 'Dentro' : 'Fora'} da faixa alvo.\n`;

      if (Number.isFinite(io) && io > 0) {
        const diffIO = io - idade;
        analise += `\nIdade óssea informada: ${io.toFixed(1)} anos\n`;
        analise += `IO - IC: ${diffIO.toFixed(1)} ano(s)\n`;
        analise += `Interpretação IO: PLACEHOLDER (definir regra e limiares).`;
      } else {
        analise += `\nIdade óssea: não informada (opcional).`;
      }

      showResult('res-ap', analise);
    }

    // =========================
    // 3) CARDIO
    // =========================
    function calcECG() {
      const qtq = Number(document.getElementById('ecg-qt-q').value);
      const rrq = Number(document.getElementById('ecg-rr-q').value);
      if (!Number.isFinite(qtq) || qtq <= 0) return showResult('res-ecg', 'Informe QT (quadradinhos).');
      if (!Number.isFinite(rrq) || rrq <= 0) return showResult('res-ecg', 'Informe RR (quadradinhos).');

      const qt_s = qtq * 0.04;
      const rr_s = rrq * 0.04;

      const qtc_bazett = qt_s / Math.sqrt(rr_s);
      const qtc_fridericia = qt_s / Math.cbrt(rr_s);
      const fc = 1500 / rrq;

      const msg =
        `FC estimada: ${fc.toFixed(0)} bpm\n` +
        `QT: ${qt_s.toFixed(3)} s\nRR: ${rr_s.toFixed(3)} s\n\n` +
        `QTc (Bazett): ${(qtc_bazett * 1000).toFixed(0)} ms\n` +
        `QTc (Fridericia): ${(qtc_fridericia * 1000).toFixed(0)} ms\n\n` +
        `Intervalos por idade/eixo: PLACEHOLDER (inserir tabela).`;

      showResult('res-ecg', msg);
    }

    function classificarPA() {
      const pas = Number(document.getElementById('pa-pas').value);
      const pad = Number(document.getElementById('pa-pad').value);
      const idade = Number(document.getElementById('pa-idade').value);
      const sexo = document.getElementById('pa-sexo').value;
      const est = Number(document.getElementById('pa-estatura').value);

      if (!Number.isFinite(pas) || pas <= 0) return showResult('res-pa', 'Informe PAS.');
      if (!Number.isFinite(pad) || pad <= 0) return showResult('res-pa', 'Informe PAD.');
      if (!Number.isFinite(idade) || idade < 0) return showResult('res-pa', 'Informe idade.');
      if (!Number.isFinite(est) || est <= 0) return showResult('res-pa', 'Informe estatura (cm) ou percentil.');

      if (idade >= 18) {
        let cls = 'Normal';
        if (pas < 120 && pad < 80) cls = 'Normal';
        else if (pas >= 120 && pas <= 129 && pad < 80) cls = 'PA elevada';
        else if ((pas >= 130 && pas <= 139) || (pad >= 80 && pad <= 89)) cls = 'HAS estágio 1';
        else if (pas >= 140 || pad >= 90) cls = 'HAS estágio 2';
        if (pas >= 180 || pad >= 120) cls = 'Crise hipertensiva (avaliar urgência/emergência)';

        showResult('res-pa', `Adulto (SBC - numérico): ${cls}\nPAS/PAD: ${pas}/${pad} mmHg`);
        return;
      }

      const msg =
        `Pediatria (SBP): classificação requer percentis por idade/sexo/estatura.\n\n` +
        `Dados: ${idade} anos | sexo ${sexo} | estatura ${est}\nPAS/PAD: ${pas}/${pad} mmHg\n\n` +
        `ATUALIZAR_CONFORME_SBP: plugar tabela percentílica (P90/P95/P95+12).`;
      showResult('res-pa', msg);
    }

    // =========================
    // 4) EMERGÊNCIA (placeholders)
    // =========================
    function getPesoIdadeEmerg() {
      const peso = Number(document.getElementById('em-peso').value);
      const idade = Number(document.getElementById('em-idade').value);
      if (!Number.isFinite(peso) || peso <= 0) return { error: 'Informe peso (kg).' };
      if (!Number.isFinite(idade) || idade < 0) return { error: 'Informe idade (anos).' };
      return { peso, idade };
    }
    const EMERG_DOSES = {
      rcp: { epi_mgkg: 0.01, amio_mgkg: 5, lido_mgkg: 1, defib_jkg_1: 2, defib_jkg_2: 4 },
      sri: { cet_mgkg: 1.5, eto_mgkg: 0.3, mida_mgkg: 0.1, fenta_mcgkg: 2, roc_mgkg: 1.2, succ_mgkg: 2 },
      choque: { bolus_mlkg: 20 }
    };
    function calcEmerg41() {
      const base = getPesoIdadeEmerg();
      if (base.error) return showResult('res-em-41', base.error);

      const { peso, idade } = base;
      const sub = document.getElementById('em-41').value;

      let out = '';
      if (sub === 'rcp') {
        const epi = EMERG_DOSES.rcp.epi_mgkg * peso;
        const amio = EMERG_DOSES.rcp.amio_mgkg * peso;
        const lido = EMERG_DOSES.rcp.lido_mgkg * peso;
        const def1 = EMERG_DOSES.rcp.defib_jkg_1 * peso;
        const def2 = EMERG_DOSES.rcp.defib_jkg_2 * peso;

        out =
          `RCP (placeholder):\n` +
          `• Epinefrina: ${epi.toFixed(2)} mg (0,01 mg/kg IV/IO)\n` +
          `• Amiodarona: ${amio.toFixed(0)} mg (5 mg/kg)\n` +
          `• Lidocaína: ${lido.toFixed(0)} mg (1 mg/kg)\n` +
          `• Desfibrilação: ${def1.toFixed(0)} J (2 J/kg) → ${def2.toFixed(0)} J (4 J/kg)\n\n` +
          `ATUALIZAR_CONFORME_PROTOCOLO: revise doses, apresentações e máximos.`;
      }

      if (sub === 'sri') {
        const cet = EMERG_DOSES.sri.cet_mgkg * peso;
        const eto = EMERG_DOSES.sri.eto_mgkg * peso;
        const mida = EMERG_DOSES.sri.mida_mgkg * peso;
        const fenta = EMERG_DOSES.sri.fenta_mcgkg * peso;
        const roc = EMERG_DOSES.sri.roc_mgkg * peso;
        const succ = EMERG_DOSES.sri.succ_mgkg * peso;

        out =
          `SRI (placeholder):\n` +
          `Indução (escolher 1):\n` +
          `• Cetamina: ${cet.toFixed(1)} mg\n` +
          `• Etomidato: ${eto.toFixed(1)} mg\n` +
          `• Midazolam: ${mida.toFixed(1)} mg\n\n` +
          `Analgesia (se indicado):\n` +
          `• Fentanil: ${fenta.toFixed(0)} mcg\n\n` +
          `Bloqueio neuromuscular (escolher 1):\n` +
          `• Rocurônio: ${roc.toFixed(1)} mg\n` +
          `• Succinilcolina: ${succ.toFixed(1)} mg\n\n` +
          `ATUALIZAR_CONFORME_PROTOCOLO: confirme faixas, contraindicações, máximos e diluições.`;
      }

      if (sub === 'tubo') {
        const diCuffed = (idade / 4) + 3.5;
        const diUncuffed = (idade / 4) + 4.0;
        const profCuffed = 3 * diCuffed;
        const profUncuffed = 3 * diUncuffed;

        out =
          `Tubo e fixação (heurísticas clássicas):\n` +
          `• ETT cuffed (DI): idade/4 + 3,5 = ${diCuffed.toFixed(1)} mm\n` +
          `• ETT uncuffed (DI): idade/4 + 4,0 = ${diUncuffed.toFixed(1)} mm\n` +
          `• Profundidade oral (aprox): 3 × DI\n` +
          `  - cuffed: ~${profCuffed.toFixed(1)} cm\n` +
          `  - uncuffed: ~${profUncuffed.toFixed(1)} cm\n\n` +
          `Neonato: ATUALIZAR_TABELA_RN por peso/IG para DI e profundidade.`;
      }

      showResult('res-em-41', out);
    }
    function calcEmerg42() {
      const base = getPesoIdadeEmerg();
      if (base.error) return showResult('res-em-42', base.error);
      const { peso } = base;
      const sub = document.getElementById('em-42').value;

      let out = '';
      if (sub === 'proced') {
        out =
          `Sedação/analgesia para procedimentos (placeholder):\n` +
          `• Midazolam: X mg/kg → ${(peso * 0.1).toFixed(2)} mg (exemplo estrutural)\n` +
          `• Fentanil: X mcg/kg → ${(peso * 2).toFixed(0)} mcg (exemplo estrutural)\n\n` +
          `ATUALIZAR_TABELAS_SEDACAO: inserir drogas, doses, máximos e observações.`;
      } else {
        out =
          `Sedação contínua (placeholder):\n` +
          `• Midazolam: X mcg/kg/min\n` +
          `• Fentanil: X mcg/kg/h\n` +
          `• Dexmedetomidina: X mcg/kg/h\n\n` +
          `ATUALIZAR_TABELAS_SEDACAO: inserir taxas e limites conforme protocolo.`;
      }
      showResult('res-em-42', out);
    }
    function calcEmerg43() {
      const base = getPesoIdadeEmerg();
      if (base.error) return showResult('res-em-43', base.error);
      const { peso } = base;
      const sub = document.getElementById('em-43').value;

      let out = '';
      if (sub === 'crise') {
        out =
          `Crise convulsiva (placeholder):\n` +
          `• Benzodiazepínico (ex.: diazepam/midazolam): dose por kg\n` +
          `Exemplo estrutural: midazolam 0,2 mg/kg → ${(peso * 0.2).toFixed(2)} mg\n\n` +
          `ATUALIZAR_TABELAS_NEURO: definir 1ª/2ª linha, vias, repetição e máximos.`;
      } else if (sub === 'status') {
        out =
          `Status convulsivo (placeholder):\n` +
          `• 1ª linha: benzo\n` +
          `• 2ª linha: levetiracetam/fenitoína/valproato (conforme protocolo)\n` +
          `• 3ª linha: considerar UTI/intubação/sedação contínua\n\n` +
          `ATUALIZAR_TABELAS_NEURO: inserir doses e sequência temporal.`;
      } else {
        out =
          `Hipertensão intracraniana (placeholder):\n` +
          `• Elevar cabeceira, analgesia/sedação, normocapnia, tratar causa\n` +
          `• Soluções hipertônicas/manitol conforme protocolo\n\n` +
          `ATUALIZAR_TABELAS_NEURO: inserir doses e critérios.`;
      }
      showResult('res-em-43', out);
    }
    function calcEmerg44() {
      const base = getPesoIdadeEmerg();
      if (base.error) return showResult('res-em-44', base.error);
      const { peso } = base;
      const sub = document.getElementById('em-44').value;

      let out = '';
      if (sub === 'chocaveis') {
        out =
          `Ritmos chocáveis (placeholder): FV / TV sem pulso\n` +
          `• Desfibrilação: 2–4 J/kg (ver 4.1)\n` +
          `• Antiarrítmico: amiodarona/lidocaína (ver 4.1)\n\n` +
          `Peso: ${peso.toFixed(1)} kg\n` +
          `ATUALIZAR_TABELAS_RITMO: inserir sequência e doses conforme guideline.`;
      } else {
        out =
          `Ritmos não chocáveis (placeholder): AESP / assistolia\n` +
          `• Epinefrina conforme protocolo\n` +
          `• Tratar causas reversíveis (Hs e Ts)\n\n` +
          `ATUALIZAR_TABELAS_RITMO: inserir medicações, doses e checklist.`;
      }
      showResult('res-em-44', out);
    }
    function calcEmerg45() {
      const base = getPesoIdadeEmerg();
      if (base.error) return showResult('res-em-45', base.error);
      const { peso } = base;
      const tipo = document.getElementById('em-45').value;

      const bolus = EMERG_DOSES.choque.bolus_mlkg * peso;

      let out = `Choque (placeholder) — tipo: ${tipo}\n\n`;
      out += `• Cristaloide: ${bolus.toFixed(0)} mL (20 mL/kg) (exemplo)\n`;
      out += `• Vasopressores/inotrópicos: PLACEHOLDER (noradrenalina/adrenalina/dobutamina etc.)\n\n`;
      out += `ATUALIZAR_TABELAS_CHOQUE: inserir drogas, doses por kg, máximos e estratégia por tipo.`;

      showResult('res-em-45', out);
    }

    // =========================
    // 5) HIDRATAÇÃO
    // =========================
    function calcHollidaySegar() {
      const peso = Number(document.getElementById('hs-peso').value);
      const modo = document.getElementById('hs-modo').value;

      const na = Number(document.getElementById('hs-na').value);
      const k = Number(document.getElementById('hs-k').value);
      const cl = Number(document.getElementById('hs-cl').value);
      const glic = Number(document.getElementById('hs-glic').value);

      if (!Number.isFinite(peso) || peso <= 0) return showResult('res-hs', 'Informe peso (kg).');

      let vol24 = 0;
      if (peso <= 10) vol24 = 100 * peso;
      else if (peso <= 20) vol24 = 1000 + 50 * (peso - 10);
      else vol24 = 1500 + 20 * (peso - 20);

      const mlh = vol24 / 24;

      let out =
        `Manutenção (Holliday-Segar):\n` +
        `Volume 24h: ${vol24.toFixed(0)} mL\n` +
        `Taxa: ${mlh.toFixed(1)} mL/h\n\n`;

      if (modo === 'meqkg') {
        if (Number.isFinite(na)) out += `Na+ total/dia: ${(na * peso).toFixed(1)} mEq\n`;
        if (Number.isFinite(k)) out += `K+ total/dia: ${(k * peso).toFixed(1)} mEq\n`;
        if (Number.isFinite(cl)) out += `Cl- total/dia: ${(cl * peso).toFixed(1)} mEq\n`;
        if (Number.isFinite(glic)) out += `Glicose total/dia: ${(glic * peso).toFixed(1)} g\n`;
        out += `\nObservação: composição final do soro depende do volume e solução-base (placeholder).`;
      } else {
        const L24 = vol24 / 1000;
        if (Number.isFinite(na)) out += `Na+ estimado/dia: ${(na * L24).toFixed(1)} mEq\n`;
        if (Number.isFinite(k)) out += `K+ estimado/dia: ${(k * L24).toFixed(1)} mEq\n`;
        if (Number.isFinite(cl)) out += `Cl- estimado/dia: ${(cl * L24).toFixed(1)} mEq\n`;
        if (Number.isFinite(glic)) out += `Glicose estimado/dia: ${(glic * L24).toFixed(1)} g\n`;
        out += `\nObservação: isto assume concentração final homogênea (placeholder).`;
      }

      showResult('res-hs', out);
    }

    function calcVIG() {
      const peso = Number(document.getElementById('vig-peso').value);
      const alvo = Number(document.getElementById('vig-alvo').value);
      const na = Number(document.getElementById('vig-na').value);
      const k = Number(document.getElementById('vig-k').value);
      const cl = Number(document.getElementById('vig-cl').value);
      const glic = Number(document.getElementById('vig-glic').value);

      if (!Number.isFinite(peso) || peso <= 0) return showResult('res-vig', 'Informe peso (kg).');
      if (!Number.isFinite(alvo) || alvo <= 0) return showResult('res-vig', 'Informe VIG alvo (mL/kg/h).');

      const mlh = alvo * peso;
      const vol24 = mlh * 24;

      let out =
        `VIG:\n` +
        `Taxa: ${mlh.toFixed(1)} mL/h\n` +
        `Volume 24h: ${vol24.toFixed(0)} mL\n\n` +
        `Eletrólitos (mEq/L) informados:\n` +
        `Na+: ${Number.isFinite(na) ? na.toFixed(1) : '—'} | K+: ${Number.isFinite(k) ? k.toFixed(1) : '—'} | Cl-: ${Number.isFinite(cl) ? cl.toFixed(1) : '—'}\n` +
        `Glicose (g/L): ${Number.isFinite(glic) ? glic.toFixed(1) : '—'}\n\n` +
        `ATUALIZAR: definir cálculo de prescrição final por solução-base e aditivos (placeholder).`;

      showResult('res-vig', out);
    }

    function calcSchwartz() {
      const cr = Number(document.getElementById('ren-cr').value);
      const alt = Number(document.getElementById('ren-alt').value);
      if (!Number.isFinite(cr) || cr <= 0) return showResult('res-renal', 'Informe creatinina.');
      if (!Number.isFinite(alt) || alt <= 0) return showResult('res-renal', 'Informe estatura (cm).');

      const etfg = (0.413 * alt) / cr;
      showResult('res-renal', `eTFG (Schwartz): ${etfg.toFixed(1)} mL/min/1,73m²`);
    }

    // =========================
    // 6) LABORATÓRIOS
    // =========================
    function calcGasoConduta() {
      const ph = Number(document.getElementById('g-ph').value);
      const pco2 = Number(document.getElementById('g-pco2').value);
      const hco3 = Number(document.getElementById('g-hco3').value);
      const na = Number(document.getElementById('g-na').value);
      const cl = Number(document.getElementById('g-cl').value);
      const alb = Number(document.getElementById('g-alb').value);

      if (!Number.isFinite(ph) || ph <= 0) return showResult('res-gaso', 'Informe pH.');
      if (!Number.isFinite(pco2) || pco2 <= 0) return showResult('res-gaso', 'Informe pCO2.');
      if (!Number.isFinite(hco3) || hco3 <= 0) return showResult('res-gaso', 'Informe HCO3-.');
      if (!Number.isFinite(na) || na <= 0) return showResult('res-gaso', 'Informe Na+.');
      if (!Number.isFinite(cl) || cl <= 0) return showResult('res-gaso', 'Informe Cl-.');

      const ag = na - (cl + hco3);
      let agCorr = ag;
      let agMsg = `Ânion gap: ${ag.toFixed(1)}`;

      if (Number.isFinite(alb) && alb > 0) {
        agCorr = ag + 2.5 * (4 - alb);
        agMsg += `\nÂnion gap corrigido (Alb): ${agCorr.toFixed(1)} (Alb ${alb.toFixed(1)} g/dL)`;
      }

      const acidemia = ph < 7.35;
      const alcalemia = ph > 7.45;

      let prim = 'Indeterminado';
      if (acidemia) prim = (hco3 < 22) ? 'Acidose metabólica (provável)' : 'Acidose respiratória (provável)';
      else if (alcalemia) prim = (hco3 > 26) ? 'Alcalose metabólica (provável)' : 'Alcalose respiratória (provável)';
      else prim = 'pH normal/compensado (avaliar distúrbios mistos)';

      let comp = '';
      if (hco3 < 22) {
        const exp = 1.5 * hco3 + 8;
        comp = `Compensação (Winter): pCO2 esperada ~ ${exp.toFixed(1)} mmHg (±2)`;
      } else if (hco3 > 26) {
        const exp = 0.7 * (hco3 - 24) + 40;
        comp = `Compensação alcalose metabólica: pCO2 esperada ~ ${exp.toFixed(1)} mmHg (±5)`;
      } else {
        comp = 'Compensação: avaliar no contexto clínico (placeholder).';
      }

      let conduta =
        `Conduta (orientativa):\n` +
        `• Correlacionar com clínica, lactato/cetonas/sepse/choque/IRA\n` +
        `• Se acidose metabólica com AG alto: pensar em lactato/cetoacidose/uremia/tox.\n` +
        `• Se AG normal (hiperclorêmica): pensar em diarreia/ATR/expansão com SF\n` +
        `• Ajustar ventilação apenas se indicado (evitar hiperventilação iatrogênica)\n\n` +
        `ATUALIZAR: adicionar fluxos de conduta por diagnóstico institucional.`;

      const out =
        `${prim}\n\n` +
        `pH: ${ph.toFixed(2)} | pCO2: ${pco2.toFixed(1)} | HCO3-: ${hco3.toFixed(1)}\n` +
        `${agMsg}\n\n` +
        `${comp}\n\n` +
        `${conduta}`;

      showResult('res-gaso', out);
    }

    function convertLab() {
      const fator = Number(document.getElementById('lab-conv').value);
      const val = Number(document.getElementById('lab-val').value);
      if (!Number.isFinite(val)) return showResult('res-lab', 'Informe o valor para converter.');
      const res = val * fator;
      showResult('res-lab', `Resultado: ${res.toFixed(2)}`);
    }

    // =========================
    // CHECKLIST (placeholder)
    // =========================
    function renderCheck() {
      const idade = document.getElementById('ck-idade').value;
      const area = document.getElementById('check-area');
      if (!idade) { area.innerHTML = ''; return; }

      const itens = {
        '2': ['Vacinas do 2º mês', 'Aleitamento materno', 'Triagem auditiva/olhinho (se pendente)'],
        '6': ['Introdução alimentar', 'Vacinas do 6º mês', 'Avaliar marcos do desenvolvimento'],
        '12': ['Vacinas 12 meses', 'Triagem anemia/ferro (conforme risco)', 'Avaliar linguagem e marcha']
      };

      const list = (itens[idade] || []).map(i => `<li>${i}</li>`).join('');
      area.innerHTML = `<div class="result-box" style="display:block"><span class="destaque">Checklist (placeholder)</span><ul style="margin:10px 0 0 18px">${list}</ul></div>`;
    }

    // =========================
    // MRPA — gerar dias 2 a 5
    // =========================
    (function(){
      const alvo = document.getElementById('mrpa-dias');
      if(!alvo) return;

      const dias = [2,3,4,5];

      dias.forEach((d)=>{
        const base = (d-2)*6;
        alvo.insertAdjacentHTML('beforeend', `
          <div class="card" style="box-shadow:none;border:1px solid rgba(0,0,0,0.06)">
            <div class="mrpa-row-title">${d}º Dia (____ / ____ / ____)</div>

            <div class="mrpa-row-title" style="font-size:0.85rem;margin:0 0 6px">☀️ Manhã</div>
            <div class="mrpa-grid-3">
              ${[1,2,3].map(i=>medicaoHTML(base+i)).join('')}
            </div>

            <div class="mrpa-row-title" style="font-size:0.85rem;margin:12px 0 6px">🌙 Noite</div>
            <div class="mrpa-grid-3">
              ${[4,5,6].map(i=>medicaoHTML(base+i)).join('')}
            </div>
          </div>
        `);
      });

      function medicaoHTML(n){
        const rotulo = (n+2) + 'ª Medição';
        return `
          <div class="mrpa-medicao">
            <div class="mrpa-row-title" style="font-size:0.85rem;margin-bottom:6px">${rotulo}</div>
            <div class="mrpa-label">Hora</div><div class="mrpa-box"></div>
            <div class="mrpa-label">PAS</div><div class="mrpa-box"></div>
            <div class="mrpa-label">PAD</div><div class="mrpa-box"></div>
            <div class="mrpa-label">Pulso</div><div class="mrpa-box"></div>
          </div>
        `;
      }
    })();
    // ===== MRPA: Papel A4/A5 dinâmico + Rodapé (Local/Data + Médico/CRM) =====
(function ensureMRPASetup(){
  // Style tag para controlar tamanho do papel via JS (melhor compatibilidade)
  let st = document.getElementById('mrpaPageSizeStyle');
  if(!st){
    st = document.createElement('style');
    st.id = 'mrpaPageSizeStyle';
    document.head.appendChild(st);
  }

  // Define padrão A4 ao carregar
  setMRPAPaperSize();

  // Atualiza rodapé antes de imprimir
  window.addEventListener('beforeprint', () => {
    updateMRPAFooter();
    setMRPAPaperSize(); // garante que @page está atualizado
  });

  // Também atualiza quando a pessoa muda campos (mais “ao vivo”)
  ['mrpa-local','mrpa-medico','mrpa-crm'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.addEventListener('input', updateMRPAFooter);
  });
})();

function setMRPAPaperSize(){
  const sel = document.getElementById('mrpa-paper');
  const val = sel ? sel.value : 'A4';

  const st = document.getElementById('mrpaPageSizeStyle');
  if(!st) return;

  // Margens pensadas para caber bem em A4 e A5
  if(val === 'A5'){
    st.textContent = `
      @media print{
        @page { size: A5 portrait; margin: 10mm; }
      }
    `;
  } else {
    st.textContent = `
      @media print{
        @page { size: A4 portrait; margin: 12mm; }
      }
    `;
  }
}

function updateMRPAFooter(){
  const local = (document.getElementById('mrpa-local')?.value || '').trim();
  const medico = (document.getElementById('mrpa-medico')?.value || '').trim();
  const crm = (document.getElementById('mrpa-crm')?.value || '').trim();

  // Data automática pt-BR
  const hoje = new Date();
  const data = hoje.toLocaleDateString('pt-BR');

  // Regra que você pediu: "Local e data alinhado à direita e ANTES do nome do médico e CRM"
  const localDataEl = document.getElementById('mrpa-local-data');
  const medicoCrmEl = document.getElementById('mrpa-medico-crm');

  if(localDataEl){
    const prefixo = local ? local : 'Local';
    localDataEl.textContent = `${prefixo}, ${data}`;
  }

  if(medicoCrmEl){
    const med = medico ? medico : 'Médico(a)';
    const cr = crm ? crm : 'CRM';
    medicoCrmEl.textContent = `${med} • ${cr}`;
  }
}
    function openCardioSub(subId){
  // Esconde todas as sub-abas da cardio
  document.querySelectorAll('#tab-cardio .cardio-sub').forEach(el => el.classList.remove('active'));
  const target = document.getElementById(subId);
  if (target) target.classList.add('active');

  // (opcional) deixa o scroll no topo
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function printMRPA(){
  // 1) Garante que a ABA Cardio está ativa (se você estiver em outra)
  //    Isso é importante porque alguns navegadores não renderizam direito algo "oculto" no print.
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  const tabCardio = document.getElementById('tab-cardio');
  if(tabCardio) tabCardio.classList.add('active');

  // 2) Garante que a sub-aba MRPA está ativa
  openCardioSub('cardio-mrpa');

  // 3) Atualiza rodapé (local/data + medico/crm) antes de imprimir
  if (typeof updateMRPAFooter === 'function') updateMRPAFooter();
  if (typeof setMRPAPaperSize === 'function') setMRPAPaperSize();

  // 4) Pequeno delay para o DOM aplicar display/visibilidade antes do print
  setTimeout(() => window.print(), 150);
}
    // ===== MRPA: gera dias 2 a 5 com 3 manhã + 3 noite =====
(function(){
  const alvo = document.getElementById('mrpa-dias');
  if(!alvo) return;

  const dias = [2,3,4,5];
  dias.forEach(d=>{
    alvo.insertAdjacentHTML('beforeend', `
      <div class="card" style="box-shadow:none;border:1px solid rgba(0,0,0,0.10)">
        <div class="mrpa-row-title">${d}º Dia (____ / ____ / ____)</div>

        <div style="font-weight:800;color:var(--primary);margin:6px 0 8px">☀️ Manhã</div>
        <div class="mrpa-grid-3">
          ${[1,2,3].map(i=>medicaoHTML(`Manhã — ${i}`)).join('')}
        </div>

        <div style="font-weight:800;color:var(--primary);margin:12px 0 8px">🌙 Noite</div>
        <div class="mrpa-grid-3">
          ${[1,2,3].map(i=>medicaoHTML(`Noite — ${i}`)).join('')}
        </div>
      </div>
    `);
  });

  function medicaoHTML(titulo){
    return `
      <div class="mrpa-medicao">
        <div class="mrpa-row-title" style="font-size:0.9rem">${titulo}</div>
        <div class="mrpa-label">Hora</div><div class="mrpa-box"></div>
        <div class="mrpa-label">PAS</div><div class="mrpa-box"></div>
        <div class="mrpa-label">PAD</div><div class="mrpa-box"></div>
        <div class="mrpa-label">Pulso</div><div class="mrpa-box"></div>
      </div>
    `;
  }
})();

// ===== MRPA: papel A4/A5 via @page =====
function setMRPAPaperSize(){
  let st = document.getElementById('mrpaPageSizeStyle');
  if(!st){
    st = document.createElement('style');
    st.id = 'mrpaPageSizeStyle';
    document.head.appendChild(st);
  }
  const val = document.getElementById('mrpa-paper')?.value || 'A4';
  st.textContent = `
    @media print{
      @page { size: ${val} portrait; margin: ${val === 'A5' ? '10mm' : '12mm'}; }
    }
  `;
}

// ===== MRPA: imprimir garantindo que MRPA esteja visível =====
function openCardioSub(subId){
  document.querySelectorAll('#tab-cardio .cardio-sub').forEach(el => el.classList.remove('active'));
  document.getElementById(subId)?.classList.add('active');
}

function printMRPA(){
  // ativa aba cardio (se necessário)
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.getElementById('tab-cardio')?.classList.add('active');

  // ativa sub-aba MRPA
  openCardioSub('cardio-mrpa');

  setMRPAPaperSize();

  setTimeout(()=>window.print(), 150);
}
  </script>
</body>
</html>
