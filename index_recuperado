<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PueriCalc - Dr. Wevelin Matos</title>

  <!-- Bibliotecas e Fontes -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    :root {
      --primary: rgb(40,90,129);
      --secondary: rgb(185,224,229);
      --emergency: #d32f2f;
      --cardio: #c0392b;
      --lab: #16a085;
      --renal: #2980b9;
      --check: #27ae60;
      --bg: #f4f7f9;
      --text: #2c3e50;
      --white: #ffffff;
      --shadow: 0 4px 15px rgba(0,0,0,0.08);
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Inter', 'Arial', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
    h1, h2, h3 { font-family: 'Comfortaa', cursive; text-align: center; color: var(--primary); }
    header { background: var(--white); padding: 28px 20px 16px; text-align: center; box-shadow: var(--shadow); border-bottom: 3px solid var(--primary); }
    nav { position: sticky; top: 0; z-index: 1000; background: var(--primary); display: flex; overflow-x: auto; padding: 5px; scrollbar-width: none; }
    nav::-webkit-scrollbar { display: none; }
    .nav-btn { background: none; border: none; color: rgba(255,255,255,0.7); padding: 12px 18px; font-size: 0.75rem; font-weight: 700; white-space: nowrap; cursor: pointer; text-transform: uppercase; }
    .nav-btn.active { color: var(--white); border-bottom: 3px solid var(--white); }
    .container { padding: 18px; max-width: 780px; margin: 0 auto; padding-bottom: 110px; }
    .tab-content { display: none; animation: fadeIn 0.25s ease; }
    .tab-content.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .card { background: var(--white); border-radius: 15px; padding: 18px; margin-bottom: 18px; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.03); }
    .card-header { border-left: 5px solid var(--primary); padding-left: 12px; margin-bottom: 12px; text-align: left; }
    .card-header h2 { text-align: left; margin: 0; font-size: 1.05rem; }
    label { display: block; font-size: 0.8rem; font-weight: 800; margin-top: 10px; color: var(--primary); }
    input, select, textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #dce4ec; background: rgb(185,224,229); font-size: 16px; color: var(--text); }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    button.calc-btn { width: 100%; padding: 14px; border-radius: 10px; border: none; background: var(--primary); color: white; font-weight: 800; cursor: pointer; margin-top: 14px; font-family: 'Comfortaa'; }
    button.calc-btn:active { transform: scale(0.98); opacity: 0.92; }
    .result-box { margin-top: 14px; padding: 14px; border-radius: 10px; background: var(--secondary); border: 1px solid rgba(40,90,129,0.2); display: none; font-size: 0.9rem; line-height: 1.6; white-space: pre-line; }
    .destaque { font-weight: 900; color: var(--primary); }
    .muted { color: #6b7b87; font-size: 0.78rem; margin-top: 8px; line-height: 1.3; }
    .warn { color: #8a2b2b; font-weight: 800; }
    footer { text-align: center; padding: 30px 18px; color: #7f8c8d; font-size: 0.75rem; border-top: 1px solid #eee; }
  </style>
</head>

<body>
  <header>
    <h1>PueriCalc • Dr. Wevelin Matos</h1>
    <div class="muted">Neonato • Crescimento • Cardio • Emergência • Hidratação • Laboratórios • Checklist</div>
  </header>

  <nav>
    <button class="nav-btn active" onclick="openTab('tab-neo', this)">Neonato</button>
    <button class="nav-btn" onclick="openTab('tab-cresc', this)">Crescimento</button>
    <button class="nav-btn" onclick="openTab('tab-cardio', this)">Cardio</button>
    <button class="nav-btn" onclick="openTab('tab-emerg', this)">Emergência</button>
    <button class="nav-btn" onclick="openTab('tab-hidra', this)">Hidratação</button>
    <button class="nav-btn" onclick="openTab('tab-lab', this)">Laboratórios</button>
    <button class="nav-btn" onclick="openTab('tab-check', this)">Checklist</button>
  </nav>

  <div class="container">

    <!-- ABA NEONATO -->
    <div id="tab-neo" class="tab-content active">
      <div class="card">
        <div class="card-header"><h2>Idade Gestacional e DPP</h2></div>
        <label>Modo de Entrada</label>
        <select id="neo-modo" onchange="toggleNeoInput()">
          <option value="dum">DUM (Data Última Menstruação)</option>
          <option value="usg">USG 1º Trimestre</option>
        </select>

        <div id="box-dum">
          <label>Data da DUM</label>
          <input type="date" id="neo-dum">
        </div>

        <div id="box-usg" style="display:none">
          <label>Data do USG</label>
          <input type="date" id="neo-usg-data">
          <div class="grid-2">
            <div>
              <label>Semanas no USG</label>
              <input type="number" id="neo-usg-sem" min="0" step="1">
            </div>
            <div>
              <label>Dias no USG</label>
              <input type="number" id="neo-usg-dias" min="0" max="6" step="1">
            </div>
          </div>
        </div>

        <label>Data para cálculo (ex.: data do parto)</label>
        <input type="date" id="neo-ig-calc">
        <button class="calc-btn" onclick="calcNeoIG()">Calcular IG e DPP</button>
        <div id="res-neo-ig" class="result-box"></div>
      </div>

      <div class="card">
        <div class="card-header"><h2>Idade Gestacional Corrigida Pós-Nascimento</h2></div>
        <div class="grid-2">
          <div>
            <label>IG ao nascimento (semanas)</label>
            <input type="number" id="neo-ig-nasc-sem" min="0" step="1">
          </div>
          <div>
            <label>IG ao nascimento (dias)</label>
            <input type="number" id="neo-ig-nasc-dias" min="0" max="6" step="1">
          </div>
        </div>
        <div class="grid-2">
          <div><label>Data de nascimento</label><input type="date" id="neo-data-nasc"></div>
          <div><label>Data para cálculo</label><input type="date" id="neo-data-posnatal"></div>
        </div>
        <button class="calc-btn" onclick="calcIGCorrigidaPosNatal()">Calcular Corrigida Pós-Natal</button>
        <div id="res-neo-igcorr" class="result-box"></div>
      </div>
    </div>

    <!-- ABA CRESCIMENTO -->
    <div id="tab-cresc" class="tab-content">
      <div class="card">
        <div class="card-header"><h2>Velocidades (PC, Peso, Estatura) — bloco único</h2></div>
        <div class="grid-2">
          <div><label>Data inicial</label><input type="date" id="cr-data-i"></div>
          <div><label>Data final</label><input type="date" id="cr-data-f"></div>
        </div>
        <button class="calc-btn" onclick="calcVelocidadesCrescimento()">Calcular velocidades</button>
        <div id="res-cr-peso" class="result-box"></div>
      </div>
    </div>

    <!-- ABA CARDIO -->
    <div id="tab-cardio" class="tab-content">
      <div class="card">
        <div class="card-header" style="border-color:var(--cardio)"><h2>Avaliação de ECG</h2></div>
        <div class="grid-2">
          <div><label>QT (quadradinhos)</label><input type="number" id="ecg-qt-q" step="1" min="1"></div>
          <div><label>RR (quadradinhos)</label><input type="number" id="ecg-rr-q" step="1" min="1"></div>
        </div>
        <button class="calc-btn" style="background:var(--cardio)" onclick="calcECG()">Analisar ECG (QTc + FC)</button>
        <div id="res-ecg" class="result-box"></div>
      </div>

      <!-- ✅ Mantive seus módulos completos (Sport + Preop) -->
      <!-- Cole aqui exatamente seus blocos HTML do Atestado e do Pré-op (sem mudanças) -->
      <!-- (Para não ficar gigantesco, eu não dupliquei aqui no snippet.) -->
      <div class="card">
        <div class="card-header" style="border-color:var(--cardio)"><h2>Atestado e Pré-op</h2></div>
        <div class="muted">
          Seu HTML do SportModule e PreopModule continua funcionando (o problema era o JS quebrado antes).
          Cole aqui os blocos que você já tem (Atestado + Pré-op) exatamente como estavam.
        </div>
      </div>
    </div>

    <!-- ABA EMERGÊNCIA -->
    <div id="tab-emerg" class="tab-content">
      <div class="card">
        <div class="card-header" style="border-color:var(--emergency)"><h2>Emergência</h2></div>
        <div class="muted">Estrutura ok. (As funções antigas estavam quebrando o JS e travando as abas.)</div>
      </div>
    </div>

    <!-- ABA HIDRATAÇÃO -->
    <div id="tab-hidra" class="tab-content">
      <div class="card">
        <div class="card-header" style="border-color:var(--renal)"><h2>Hidratação</h2></div>
      </div>
    </div>

    <!-- ABA LAB -->
    <div id="tab-lab" class="tab-content">
      <div class="card">
        <div class="card-header" style="border-color:var(--lab)"><h2>Laboratórios</h2></div>
      </div>
    </div>

    <!-- ABA CHECKLIST -->
    <div id="tab-check" class="tab-content">
      <div class="card">
        <div class="card-header" style="border-color:var(--check)"><h2>Puericultura Inteligente</h2></div>
        <label>Idade da Consulta</label>
        <select id="ck-idade" onchange="renderCheck()">
          <option value="">Selecione...</option>
          <option value="2">2 Meses</option>
          <option value="6">6 Meses</option>
          <option value="12">12 Meses</option>
        </select>
        <div id="check-area" style="margin-top:15px"></div>
      </div>
    </div>

    <div class="card">
      <h3 style="font-size:0.9rem">Bibliografia de Referência</h3>
      <ul style="font-size:0.75rem; color:#7f8c8d; padding-left:15px">
        <li>SBP - Diretrizes (inserir versão/ano conforme uso)</li>
        <li>OMS - Growth Standards (2006)</li>
        <li>AHA - PALS Guidelines (ajustar versão conforme protocolo)</li>
        <li>Schwartz GJ, et al. (2009)</li>
        <li>INTERGROWTH-21st Project (2014)</li>
      </ul>
    </div>

  </div>

  <footer>Versão de trabalho • Estruturas prontas para atualização conforme SBP/SBC • Offline-friendly</footer>

  <!-- ✅ SCRIPT ÚNICO (sem duplicar <script>) -->
  <script>
    // =========================
    // AUTO-PREENCHER DATA DE HOJE
    // =========================
    function setTodayOnAllDateInputs() {
      const hoje = new Date();
      const ano = hoje.getFullYear();
      const mes = String(hoje.getMonth() + 1).padStart(2, '0');
      const dia = String(hoje.getDate()).padStart(2, '0');
      const dataAtual = `${ano}-${mes}-${dia}`; // ✅ agora correto

      document.querySelectorAll('input[type="date"]').forEach(inp => {
        if (!inp.value) inp.value = dataAtual;
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      setTodayOnAllDateInputs();

      // Se por algum motivo nenhum botão estiver "active", garante primeira aba
      const anyActive = document.querySelector('.tab-content.active');
      if (!anyActive) {
        openTab('tab-neo', document.querySelector('.nav-btn'));
      }
    });

    // =========================
    // ABAS
    // =========================
    function openTab(tabId, btnEl) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      const target = document.getElementById(tabId);
      if (target) target.classList.add('active');

      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      if (btnEl) btnEl.classList.add('active');

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // =========================
    // UTILITÁRIOS
    // =========================
    function showResult(elId, text) {
      const el = document.getElementById(elId);
      if (!el) return;
      el.style.display = 'block';
      el.textContent = text;
    }
    function parseDate(v) {
      if (!v) return null;
      const d = new Date(v + "T00:00:00");
      return isNaN(d.getTime()) ? null : d;
    }
    function diffDays(d1, d2) {
      return Math.floor((d2.getTime() - d1.getTime()) / (1000 * 60 * 60 * 24));
    }
    function weeksDaysFromTotalDays(totalDays) {
      const w = Math.floor(totalDays / 7);
      const d = totalDays % 7;
      return { w, d };
    }

    // =========================
    // ✅ STUBS (para não quebrar o app)
    // =========================
    function toggleNeoInput() {
      const modo = document.getElementById('neo-modo')?.value || 'dum';
      const dum = document.getElementById('box-dum');
      const usg = document.getElementById('box-usg');
      if (dum) dum.style.display = (modo === 'dum') ? 'block' : 'none';
      if (usg) usg.style.display = (modo === 'usg') ? 'block' : 'none';
    }

    function calcNeoIG() {
      // Placeholder mínimo (só para não quebrar)
      const dataCalc = parseDate(document.getElementById('neo-ig-calc')?.value);
      if (!dataCalc) return showResult('res-neo-ig', 'Informe a data para cálculo.');
      showResult('res-neo-ig', 'OK ✅ (função de cálculo completa será reinserida na próxima etapa).');
    }

    function calcIGCorrigidaPosNatal() {
      showResult('res-neo-igcorr', 'OK ✅ (função completa será reinserida).');
    }

    function calcVelocidadesCrescimento() {
      showResult('res-cr-peso', 'OK ✅ (função completa será reinserida).');
    }

    function calcECG() {
      const qtq = Number(document.getElementById('ecg-qt-q')?.value);
      const rrq = Number(document.getElementById('ecg-rr-q')?.value);
      if (!Number.isFinite(qtq) || qtq <= 0) return showResult('res-ecg', 'Informe QT (quadradinhos).');
      if (!Number.isFinite(rrq) || rrq <= 0) return showResult('res-ecg', 'Informe RR (quadradinhos).');

      const qt_s = qtq * 0.04;
      const rr_s = rrq * 0.04;
      const qtc_bazett = qt_s / Math.sqrt(rr_s);
      const qtc_fridericia = qt_s / Math.cbrt(rr_s);
      const fc = 1500 / rrq;

      const msg =
`FC estimada: ${fc.toFixed(0)} bpm
QT: ${qt_s.toFixed(3)} s
RR: ${rr_s.toFixed(3)} s

QTc (Bazett): ${(qtc_bazett * 1000).toFixed(0)} ms
QTc (Fridericia): ${(qtc_fridericia * 1000).toFixed(0)} ms`;

      showResult('res-ecg', msg);
    }

    function renderCheck() {
      const idade = document.getElementById('ck-idade')?.value;
      const area = document.getElementById('check-area');
      if (!area) return;

      if (!idade) { area.innerHTML = ''; return; }

      const itens = {
        '2': ['Vacinas do 2º mês', 'Aleitamento materno', 'Triagem auditiva/olhinho (se pendente)'],
        '6': ['Introdução alimentar', 'Vacinas do 6º mês', 'Avaliar marcos do desenvolvimento'],
        '12': ['Vacinas 12 meses', 'Triagem anemia/ferro (conforme risco)', 'Avaliar linguagem e marcha']
      };
      const list = (itens[idade] || []).map(i => `<li>${i}</li>`).join('');
      area.innerHTML = `<div class="result-box" style="display:block">
        <span class="destaque">Checklist (placeholder)</span>
        <ul style="margin:10px 0 0 18px">${list}</ul>
      </div>`;
    }

    // =========================
    // IMPORTANTE
    // Aqui você cola (sem alterar) os seus módulos:
    // SportModule e PreopModule (o JS deles está bom)
    // =========================

  </script>
</body>
</html>
